!function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-meta"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-meta")):e(window.loadImage)}(function(e){"use strict";e.ExifMap=function(){return this},e.ExifMap.prototype.map={Orientation:274},e.ExifMap.prototype.get=function(e){return this[e]||this[this.map[e]]},e.getExifThumbnail=function(e,i,t){var a,n,f;{if(t&&!(i+t>e.byteLength)){for(a=[],n=0;n<t;n+=1)f=e.getUint8(i+n),a.push((f<16?"0":"")+f.toString(16));return"data:image/jpeg,%"+a.join("%")}console.log("Invalid Exif data: Invalid thumbnail data.")}},e.exifTagTypes={1:{getValue:function(e,i){return e.getUint8(i)},size:1},2:{getValue:function(e,i){return String.fromCharCode(e.getUint8(i))},size:1,ascii:!0},3:{getValue:function(e,i,t){return e.getUint16(i,t)},size:2},4:{getValue:function(e,i,t){return e.getUint32(i,t)},size:4},5:{getValue:function(e,i,t){return e.getUint32(i,t)/e.getUint32(i+4,t)},size:8},9:{getValue:function(e,i,t){return e.getInt32(i,t)},size:4},10:{getValue:function(e,i,t){return e.getInt32(i,t)/e.getInt32(i+4,t)},size:8}},e.exifTagTypes[7]=e.exifTagTypes[1],e.getExifValue=function(i,t,a,n,f,g){var o,r,s,l,u,d,x=e.exifTagTypes[n];if(x){if(o=x.size*f,!((r=o>4?t+i.getUint32(a+8,g):a+8)+o>i.byteLength)){if(1===f)return x.getValue(i,r,g);for(s=[],l=0;l<f;l+=1)s[l]=x.getValue(i,r+l*x.size,g);if(x.ascii){for(u="",l=0;l<s.length&&"\0"!==(d=s[l]);l+=1)u+=d;return u}return s}console.log("Invalid Exif data: Invalid data offset.")}else console.log("Invalid Exif data: Invalid tag type.")},e.parseExifTag=function(i,t,a,n,f){var g=i.getUint16(a,n);f.exif[g]=e.getExifValue(i,t,a,i.getUint16(a+2,n),i.getUint32(a+4,n),n)},e.parseExifTags=function(e,i,t,a,n){var f,g,o;if(t+6>e.byteLength)console.log("Invalid Exif data: Invalid directory offset.");else{if(f=e.getUint16(t,a),!((g=t+2+12*f)+4>e.byteLength)){for(o=0;o<f;o+=1)this.parseExifTag(e,i,t+2+12*o,a,n);return e.getUint32(g,a)}console.log("Invalid Exif data: Invalid directory size.")}},e.parseExifData=function(i,t,a,n,f){if(!f.disableExif){var g,o,r,s=t+10;if(1165519206===i.getUint32(t+4))if(s+8>i.byteLength)console.log("Invalid Exif data: Invalid segment size.");else if(0===i.getUint16(t+8)){switch(i.getUint16(s)){case 18761:g=!0;break;case 19789:g=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}42===i.getUint16(s+2,g)?(o=i.getUint32(s+4,g),n.exif=new e.ExifMap,(o=e.parseExifTags(i,s,s+o,g,n))&&!f.disableExifThumbnail&&(r={exif:{}},o=e.parseExifTags(i,s,s+o,g,r),r.exif[513]&&(n.exif.Thumbnail=e.getExifThumbnail(i,s+r.exif[513],r.exif[514]))),n.exif[34665]&&!f.disableExifSub&&e.parseExifTags(i,s,s+n.exif[34665],g,n),n.exif[34853]&&!f.disableExifGps&&e.parseExifTags(i,s,s+n.exif[34853],g,n)):console.log("Invalid Exif data: Missing TIFF marker.")}else console.log("Invalid Exif data: Missing byte alignment offset.")}},e.metaDataParsers.jpeg[65505].push(e.parseExifData)});