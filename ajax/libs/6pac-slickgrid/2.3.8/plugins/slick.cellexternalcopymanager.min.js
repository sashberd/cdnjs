!function(e){e.extend(!0,window,{Slick:{CellExternalCopyManager:function(t){function o(t,o){if(f.dataItemColumnValueExtractor){var l=f.dataItemColumnValueExtractor(t,o);if(l)return l}var n="";if(o.editor){var a={container:e("<p>"),column:o,position:{top:0,left:0},grid:c},r=new o.editor(a);r.loadValue(t),n=r.serializeValue(),r.destroy()}else n=t[o.field];return n}function l(t,o,l){if(f.dataItemColumnValueSetter)return f.dataItemColumnValueSetter(t,o,l);if(o.editor){var n={container:e("body"),column:o,position:{top:0,left:0},grid:c},a=new o.editor(n);a.loadValue(t),a.applyValue(t,l),a.destroy()}else t[o.field]=l}function n(e){var t=document.createElement("textarea");return t.style.position="absolute",t.style.left="-1000px",t.style.top=document.body.scrollTop+"px",t.value=e,g.appendChild(t),t.select(),t}function a(e,t){var o=e.getColumns(),n=t.value.split(/[\n\f\r]/);""==n[n.length-1]&&n.pop();var a=[],r=0;g.removeChild(t);for(var s=0;s<n.length;s++)""!=n[s]?a[r++]=n[s].split("\t"):a[s]=[""];var c=e.getActiveCell(),u=e.getSelectionModel().getSelectedRanges(),h=u&&u.length?u[0]:null,C=null,m=null;if(h)C=h.fromRow,m=h.fromCell;else{if(!c)return;C=c.row,m=c.cell}var p=!1,y=a.length,v=a.length?a[0].length:0;1==a.length&&1==a[0].length&&h&&(p=!0,y=h.toRow-h.fromRow+1,v=h.toCell-h.fromCell+1);var w=e.getData().length-C,S=0;if(w<y){var D=e.getData();for(S=1;S<=y-w;S++)D.push({});e.setData(D),e.render()}var R=C+y>e.getDataLength();if(f.newRowCreator&&R){var x=C+y-e.getDataLength();f.newRowCreator(x)}var E={isClipboardCommand:!0,clippedRange:a,oldValues:[],cellExternalCopyManager:d,_options:f,setDataItemValueForColumn:l,markCopySelection:i,oneCellToMultiple:p,activeRow:C,activeCell:m,destH:y,destW:v,maxDestY:e.getDataLength(),maxDestX:e.getColumns().length,h:0,w:0,execute:function(){this.h=0;for(var t=0;t<this.destH;t++){this.oldValues[t]=[],this.w=0,this.h++;for(var l=0;l<this.destW;l++){this.w++;var n=C+t,r=m+l;if(n<this.maxDestY&&r<this.maxDestX){e.getCellNode(n,r);var i=e.getDataItem(n);this.oldValues[t][l]=i[o[r].field],p?this.setDataItemValueForColumn(i,o[r],a[0][0]):this.setDataItemValueForColumn(i,o[r],a[t]?a[t][l]:""),e.updateCell(n,r),e.onCellChange.notify({row:n,cell:r,item:i,grid:e})}}}var s={fromCell:m,fromRow:C,toCell:m+this.w-1,toRow:C+this.h-1};this.markCopySelection([s]),e.getSelectionModel().setSelectedRanges([s]),this.cellExternalCopyManager.onPasteCells.notify({ranges:[s]})},undo:function(){for(var t=0;t<this.destH;t++)for(var l=0;l<this.destW;l++){var n=C+t,a=m+l;if(n<this.maxDestY&&a<this.maxDestX){e.getCellNode(n,a);var r=e.getDataItem(n);p?this.setDataItemValueForColumn(r,o[a],this.oldValues[0][0]):this.setDataItemValueForColumn(r,o[a],this.oldValues[t][l]),e.updateCell(n,a),e.onCellChange.notify({row:n,cell:a,item:r,grid:e})}}var i={fromCell:m,fromRow:C,toCell:m+this.w-1,toRow:C+this.h-1};if(this.markCopySelection([i]),e.getSelectionModel().setSelectedRanges([i]),this.cellExternalCopyManager.onPasteCells.notify({ranges:[i]}),S>1){for(var s=e.getData();S>1;S--)s.splice(s.length-1,1);e.setData(s),e.render()}}};f.clipboardCommandHandler?f.clipboardCommandHandler(E):E.execute()}function r(e,t){var l;if(!c.getEditorLock().isActive()||c.getOptions().autoEdit){if(e.which==v.ESC&&u&&(e.preventDefault(),s(),d.onCopyCancelled.notify({ranges:u}),u=null),(e.which===v.C||e.which===v.INSERT)&&(e.ctrlKey||e.metaKey)&&!e.shiftKey&&(p&&p.call(),0!=(l=c.getSelectionModel().getSelectedRanges()).length)){u=l,i(l),d.onCopyCells.notify({ranges:l});for(var r=c.getColumns(),h="",C=0;C<l.length;C++){for(var m=l[C],w=[],S=m.fromRow;S<m.toRow+1;S++){var D=[],R=c.getDataItem(S);if(""==w&&f.includeHeaderWhenCopying){for(var x=[],E=m.fromCell;E<m.toCell+1;E++)r[E].name.length>0&&x.push(r[E].name);w.push(x.join("\t"))}for(E=m.fromCell;E<m.toCell+1;E++)D.push(o(R,r[E]));w.push(D.join("\t"))}h+=w.join("\r\n")+"\r\n"}if(window.clipboardData)return window.clipboardData.setData("Text",h),!0;var V=document.activeElement;if((I=n(h)).focus(),setTimeout(function(){g.removeChild(I),V?V.focus():console.log("Not element to restore focus to after copy?")},100),y){var b=0;b=1===l.length?l[0].toRow+1-l[0].fromRow:l.length,y.call(this,b)}return!1}if(!f.readOnlyMode&&(e.which===v.V&&(e.ctrlKey||e.metaKey)&&!e.shiftKey||e.which===v.INSERT&&e.shiftKey&&!e.ctrlKey)){var I=n("");return setTimeout(function(){a(c,I)},100),!1}}}function i(e){s();for(var t=c.getColumns(),o={},l=0;l<e.length;l++)for(var n=e[l].fromRow;n<=e[l].toRow;n++){o[n]={};for(var a=e[l].fromCell;a<=e[l].toCell&&a<t.length;a++)o[n][t[a].id]=C}c.setCellCssStyles(h,o),clearTimeout(m),m=setTimeout(function(){d.clearCopySelection()},2e3)}function s(){c.removeCellCssStyles(h)}var c,u,d=this,f=t||{},h=f.copiedCellStyleLayerKey||"copy-manager",C=f.copiedCellStyle||"copied",m=0,g=f.bodyElement||document.body,p=f.onCopyInit||null,y=f.onCopySuccess||null,v={C:67,V:86,ESC:27,INSERT:45};e.extend(this,{init:function(e){(c=e).onKeyDown.subscribe(r);var t=e.getSelectionModel();if(!t)throw new Error("Selection model is mandatory for this plugin. Please set a selection model on the grid before adding this plugin: grid.setSelectionModel(new Slick.CellSelectionModel())");t.onSelectedRangesChanged.subscribe(function(e,t){c.focus()})},destroy:function(){c.onKeyDown.unsubscribe(r)},clearCopySelection:s,handleKeyDown:r,onCopyCells:new Slick.Event,onCopyCancelled:new Slick.Event,onPasteCells:new Slick.Event})}}})}(jQuery);