!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.ef=e.ef||{})}(this,function(e){"use strict";var t=new RegExp("\\&[0-7]{1,3}","g"),r=new RegExp("\\&u\\[.*?\\]","g"),n=new RegExp("\\&u.{0,4}","g"),a=new RegExp("\\&x.{0,2}","g"),o=new RegExp("\\&","g"),i=new RegExp("\\&b","g"),s=new RegExp("\\&t","g"),u=new RegExp("\\&n","g"),c=new RegExp("\\&v","g"),l=new RegExp("\\&f","g"),p=new RegExp("\\&r","g"),f=function(){throw new SyntaxError("Octal escape sequences are not allowed in EFML.")},d=function(e){if(e=e.substr(3,e.length-4),!(e=parseInt(e,16)))throw new SyntaxError("Invalid Unicode escape sequence");try{return String.fromCodePoint(e)}catch(e){throw new SyntaxError("Undefined Unicode code-point")}},h=function(e){if(e=e.substring(2),!(e=parseInt(e,16)))throw new SyntaxError("Invalid Unicode escape sequence");return String.fromCharCode(e)},v=function(e){if(e="00"+e.substring(2),!(e=parseInt(e,16)))throw new SyntaxError("Invalid hexadecimal escape sequence");return String.fromCharCode(e)},b=function(e){for(var b=e.split("&&"),y=[],g=0,m=b;g<m.length;g+=1){var N=m[g],$=N.replace(t,f).replace(r,d).replace(n,h).replace(a,v).replace(i,"\b").replace(s,"\t").replace(u,"\n").replace(c,"\v").replace(l,"\f").replace(p,"\r").replace(o,"");y.push($)}return y.join("&")},y=b,g=">#%@.-+".split(""),m="$avatar $parent $key $data $element $refs $methods $mount $umount $subscribe $unsubscribe $update $destroy __DIRECTMOUNT__".split(" "),N=/\{\{.+?\}\}/g,$=/^(\t*)( *).*/,k=/#([^}]|}[^}])*$/,w=function(e,t){return void 0===t&&(t=-2),"Failed to parse eft template: "+e+". at line "+(t+1)},x=function(e){return!e.replace(/\s/,"")},E=function(e,t){null===t.offset&&(t.offset=e.match(/\s*/)[0],t.offset&&(t.offsetReg=new RegExp("^"+t.offset)))},D=function(e,t,r){if(t.offsetReg){var n=!1;if(e=e.replace(t.offsetReg,function(){return n=!0,""}),!n)throw new SyntaxError(w("Expected indent to be grater than 0 and less than "+(t.prevDepth+1)+", but got -1",r))}return e},_=function(e,t){if(!t.indentReg){var r=e.match($)[2];r&&(t.indentReg=new RegExp(r,"g"))}},T=function(e,t,r){var n=0;t.indentReg&&(e=e.replace(/^\s*/,function(e){return e.replace(t.indentReg,"\t")}));var a=e.replace(/^\t*/,function(e){return n=e.length,""});if(/^\s/.test(a))throw new SyntaxError(w("Bad indent",r));return{depth:n,content:a}},O=function(e,t){for(var r=e,n=0;n<t;n++)r=r[r.length-1];return r},R=function(e){e=e.slice(2,e.length-2);var t=e.split("="),r=t[0],n=t.slice(1),a=r.trim().split("."),o=y(n.join("=").trim());return o?[a,o]:[a]},j=function(e){var t=e.split(N);if(1===t.length)return y(e);var r=[];2!==t.length||t[0]||t[1]?r.push(t.map(y)):r.push(0);var n=e.match(N);return n&&r.push.apply(r,n.map(R)),r},S=function(e,t){t&&e.push(t)},A=function(e){var t=j(e);if("string"==typeof t)return[t];for(var r=t[0],n=t.slice(1),a=[],o=0;o<n.length;o++)S(a,r[o]),a.push(n[o]);return S(a,r[r.length-1]),a},C=function(e){return e.replace(/\./g," ")},P=function(e){var t={},r=e.replace(k,function(e){return t.ref=e.slice(1),""}).split("."),n=r[0],a=r.slice(1);return t.tag=n,t.class=j(a.join(".")),"string"==typeof t.class?t.class=C(t.class).trim():t.class[0]&&(t.class[0]=t.class[0].map(C)),t},q=function(e){var t=e.split("=");return{name:t.shift().trim(),value:j(t.join("=").trim())}},I=function(e){var t=e.split("=");return{name:t.shift().trim(),value:t.join("=").trim()}},U=function(e,t){switch(t){case"stop":e.s=1;break;case"stopImmediate":e.i=1;break;case"prevent":e.p=1;break;case"shift":e.h=1;break;case"alt":e.a=1;break;case"ctrl":e.c=1;break;case"meta":e.t=1;break;case"capture":e.u=1;break;default:console.warn("Abandoned unsupported event option '"+t+"'.")}},F=function(e,t,r){var n=parseInt(r,10);if(isNaN(n))return U(e,r);t.push(n)},L=function(e){var t={},r=[],n=e.split("."),a=n[0],o=n.slice(1);t.l=a;for(var i=0,s=o;i<s.length;i+=1){var u=s[i];F(t,r,u)}return r.length>0&&(t.k=r),t},M=function(e){var t=e.split(":"),r=t[0],n=t.slice(1),a=n.join(":");return a?[r.trim(),j(a)]:[r.trim()]},K=function(e){var t=e.line,r=e.ast,n=e.parsingInfo,a=e.i;if(!x(t)){_(t,n),E(t,n);var o=T(D(t,n,a),n,a),i=o.depth,s=o.content;if(s){if(i<0||i-n.prevDepth>1||i-n.prevDepth==1&&-1===["comment","tag"].indexOf(n.prevType)||"comment"!==n.prevType&&0===i&&n.topExists)throw new SyntaxError(w("Expected indent to be grater than 0 and less than "+(n.prevDepth+1)+", but got "+i,a));var u=s[0];if(s=s.slice(1),!n.topExists&&g.indexOf(u)>=0&&">"!==u)throw new SyntaxError(w("No top level entry",a));if(!s&&g.indexOf(u)>=0)throw new SyntaxError(w("Empty content",a));switch((i<n.prevDepth||i===n.prevDepth&&"tag"===n.prevType)&&(n.currentNode=O(r,i)),n.prevDepth=i,u){case">":n.topExists||(n.topExists=!0,n.minDepth=i);var c=P(s),l=[{t:c.tag}];c.class&&(l[0].a={},l[0].a.class=c.class),c.ref&&(l[0].r=c.ref),n.currentNode.push(l),n.currentNode=l,n.prevType="tag";break;case"#":var p=q(s),f=p.name,d=p.value;n.currentNode[0].a||(n.currentNode[0].a={}),n.currentNode[0].a[f]=d,n.prevType="attr";break;case"%":var h=q(s),v=h.name,b=h.value;n.currentNode[0].p||(n.currentNode[0].p={}),n.currentNode[0].p[v]=b,n.prevType="prop";break;case"@":var y=I(s),N=y.name,$=y.value;n.currentNode[0].e||(n.currentNode[0].e=[]);var k=L(N),R=M($),j=R[0],S=R[1];k.m=j,S&&(k.v=S),n.currentNode[0].e.push(k),n.prevType="event";break;case".":(C=n.currentNode).push.apply(C,A(s)),n.prevType="text";break;case"-":if(-1!==m.indexOf(s))throw new SyntaxError(w("Reserved name '"+s+"' should not be used",a));n.currentNode.push({n:s,t:0}),n.prevType="node";break;case"+":n.currentNode.push({n:s,t:1}),n.prevType="list";break;default:n.prevType="comment"}}var C}},B=function(e){if(!e)throw new TypeError(w("Template required, but nothing present"));var t=typeof e;if("string"!==t)throw new TypeError(w("Expected a string, but got a(n) "+t));for(var r=e.split(/\r?\n/),n=[],a={indentReg:null,prevDepth:0,offset:null,offsetReg:null,prevType:"comment",currentNode:n,topExists:!1},o=0;o<r.length;o++)K({line:r[o],ast:n,parsingInfo:a,i:o});if(n[0])return n[0];throw new SyntaxError(w("Nothing to be parsed",r.length-1))},z=function(e,t){return t||(t=B),t(e)},G=Array.prototype,H={copy:function(e){return G.slice.call(e,0)},empty:function(e){return e.length=0,e},equals:function(e,t){if(!Array.isArray(t))return!1;if(e===t)return!0;if(e.length!==t.length)return!1;for(var r in e)if(e[r]!==t[r])return!1;return!0},pop:function(e){return G.pop.call(e)},push:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return G.push.apply(e,t)},remove:function(e,t){var r=G.indexOf.call(e,t);if(r>-1)return G.splice.call(e,r,1),t},reverse:function(e){return G.reverse.call(e)},rightUnique:function(e){for(var t=[],r=0;r<e.length;r++){for(var n=r+1;n<e.length;n++)e[r]===e[n]&&(n=r+=1);t.push(e[r])}return t},shift:function(e){return G.shift.call(e)},slice:function(e,t,r){return G.slice.call(e,t,r)},sort:function(e,t){return G.sort.call(e,t)},splice:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return G.splice.apply(e,t)},unshift:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return G.unshift.apply(e,t)}};window.Set?H.unique=function(e){return Array.from(new Set(e))}:H.unique=H.rightUnique;var J=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var n="",a=0;a<t.length;a++)n+=e[a]+t[a];return n+e[e.length-1]},Q=function(e){return e.dataNode[e._key]},V=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];if(!e)return Q(t[0]);var n=[e];return n.push.apply(n,t.map(Q)),J.apply(void 0,n)},W=function(e,t){for(var r in t)e[r]=t[r];return e},X=Object.assign||W,Y=[],Z=[],ee=0,te=function(e){return Y.push.apply(Y,e)},re=function(e){return Z.push(e)},ne=function(){return ee+=1},ae=function(e){if(!e&&(ee-=1)>0)return ee;if(ee=0,Y.length>0){for(var t=H.unique(Y),r=0,n=t;r<n.length;r+=1){(0,n[r])()}H.empty(Y)}if(Z.length>0){for(var a=H.rightUnique(Z),o=0,i=a;o<i.length;o+=1){(0,i[o])()}H.empty(Z)}return ee},oe=function(e){for(var t=e._path,r=e.handlers,n=e.subscribers,a=e.innerData,o=0,i=t;o<i.length;o+=1){var s=i[o];r[s]||(r[s]={}),n[s]||(n[s]={}),a[s]||(a[s]={}),r=r[s],n=n[s],a=a[s]}return{handlerNode:r,subscriberNode:n,dataNode:a}},ie=function(e,t,r){for(var n=0,a=e;n<a.length;n+=1){var o=a[n];if(!t[o]){var i={};Object.defineProperty(t,o,{get:function(){return i},set:function(e){ne(),X(i,e),ae()},configurable:!r,enumerable:r})}t=t[o]}return t},se=function(e){var t=e._path,r=e._key,n=e.data,a=e.handlers,o=e.subscribers,i=e.innerData,s=ie(t,n,!0),u=oe({_path:t,handlers:a,subscribers:o,innerData:i}),c=u.handlerNode,l=u.subscriberNode,p=u.dataNode;return c[r]||(c[r]=[]),l[r]||(l[r]=[]),Object.prototype.hasOwnProperty.call(p,r)||(p[r]=""),{parentNode:s,handlerNode:c[r],subscriberNode:l[r],dataNode:p}},ue=function(e,t){for(var r=e.split("."),n=r.pop(),a=0,o=r;a<o.length;a+=1){var i=o[a];t[i]||(t[i]={}),t=t[i]}return t[n]},ce=function(e){var t=e.parentNode,r=e.dataNode,n=e.handlerNode,a=e.subscriberNode,o=e.state,i=e._key;Object.defineProperty(t,i,{get:function(){return r[i]},set:function(e){if(r[i]!==e){r[i]=e,te(n),ne();for(var t=0,s=a;t<s.length;t+=1){(0,s[t])({state:o,value:e})}ae()}},enumerable:!0})},le=function(e){var t=e.bind,r=e.state,n=e.handlers,a=e.subscribers,o=e.innerData,i=H.copy(t[0]),s=t[1],u=i.pop(),c=se({_path:i,_key:u,data:r.$data,handlers:n,subscribers:a,innerData:o}),l=c.parentNode,p=c.handlerNode,f=c.subscriberNode,d=c.dataNode;return Object.prototype.hasOwnProperty.call(l,u)||ce({parentNode:l,dataNode:d,handlerNode:p,subscriberNode:f,state:r,_key:u}),s&&(l[u]=s),{dataNode:d,handlerNode:p,subscriberNode:f,_key:u}},pe=function(e,t,r){var n=document.createElement(e);return t&&Object.defineProperty(r,t,{value:n,enumerable:!0}),n},fe=function(e){var t=e.val,r=e.state,n=e.handlers,a=e.subscribers,o=e.innerData,i=e.handler;if(Array.isArray(t)){var s=t[0],u=t.slice(1),c=[s],l=function(){return i(V.apply(void 0,c))};return c.push.apply(c,u.map(function(e){var t=le({bind:e,state:r,handlers:n,subscribers:a,innerData:o}),i=t.dataNode,s=t.handlerNode,u=t._key;return s.push(l),{dataNode:i,_key:u}})),l}return function(){return t}},de=function(e){var t=e.dataNode,r=e.handlerNode,n=e.subscriberNode,a=e._handler,o=e.state,i=e._key,s=e.value;if(t[i]!==s){t[i]=s;var u=H.copy(r);H.remove(u,a),te(u),ne();for(var c=0,l=n;c<l.length;c+=1){(0,l[c])({state:o,value:s})}ae()}},he=function(e){var t=e._handler,r=e.state,n=e.handlers,a=e.subscribers,o=e.innerData,i=e.element,s=e.key,u=e.expr,c=le({bind:u,state:r,handlers:n,subscribers:a,innerData:o}),l=c.dataNode,p=c.handlerNode,f=c.subscriberNode,d=c._key,h=function(){return de({dataNode:l,handlerNode:p,subscriberNode:f,_handler:t,state:r,_key:d,value:i.value})};"value"===s?(i.addEventListener("input",h,!0),i.addEventListener("keyup",h,!0),i.addEventListener("change",h,!0)):i.addEventListener("change",function(){return de({dataNode:l,handlerNode:p,subscriberNode:f,_handler:t,state:r,_key:d,value:i.checked})},!0)},ve=function(e,t){return"class"===t?function(r){r=(""+r).replace(/\s+/g," ").trim(),e.setAttribute(t,r)}:function(r){return e.setAttribute(t,r)}},be=function(e){var t=e.element,r=e.attr,n=e.key,a=e.state,o=e.handlers,i=e.subscribers,s=e.innerData;if("string"==typeof r)t.setAttribute(n,r);else{var u=ve(t,n);te([fe({val:r,state:a,handlers:o,subscribers:i,innerData:s,handler:u})])}},ye=function(e){var t=e.element,r=e.prop,n=e.key,a=e.state,o=e.handlers,i=e.subscribers,s=e.innerData;if("string"==typeof r)t[n]=r;else{var u=function(e){t[n]=e},c=fe({val:r,state:a,handlers:o,subscribers:i,innerData:s,handler:u});"value"!==n&&"checked"!==n||r[0]||he({_handler:c,state:a,handlers:o,subscribers:i,innerData:s,element:t,key:n,expr:r[1]}),te([c])}},ge=function(e){return e},me=function(e){var t=e.element,r=e.event,n=e.state,a=e.handlers,o=e.subscribers,i=e.innerData,s=r.l,u=r.m,c=r.s,l=r.i,p=r.p,f=r.h,d=r.a,h=r.c,v=r.t,b=r.u,y=r.k,g=r.v,m=fe({val:g,state:n,handlers:a,subscribers:o,innerData:i,handler:ge});t.addEventListener(s,function(e){!!f!=!!e.shiftKey||!!d!=!!e.altKey||!!h!=!!e.ctrlKey||!!v!=!!e.metaKey||y&&-1===y.indexOf(e.which)||(c&&e.stopPropagation(),l&&e.stopImmediatePropagation(),p&&e.preventDefault(),n.$methods[u]&&n.$methods[u]({e:e,value:m(),state:n}))},!!b)},Ne=function(e){var t=e.info,r=e.state,n=e.innerData,a=e.refs,o=e.handlers,i=e.subscribers,s=t.t,u=t.a,c=t.p,l=t.e,p=t.r,f=pe(s,p,a);for(var d in u)be({element:f,attr:u[d],key:d,state:r,handlers:o,subscribers:i,innerData:n});for(var h in c)ye({element:f,prop:c[h],key:h,state:r,handlers:o,subscribers:i,innerData:n});for(var v in l)me({element:f,event:l[v],state:r,handlers:o,subscribers:i,innerData:n});return f},$e=Node.prototype,ke={before:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var n=document.createDocumentFragment();t.reverse();for(var a=0,o=t;a<o.length;a+=1){var i=o[a];$e.appendChild.call(n,i)}$e.insertBefore.call(e.parentNode,n,e)},after:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var n=document.createDocumentFragment(),a=0,o=t;a<o.length;a+=1){var i=o[a];$e.appendChild.call(n,i)}e.nextSibling?$e.insertBefore.call(e.parentNode,n,e.nextSibling):$e.appendChild.call(e.parentNode,n)},append:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];if(-1!==[1,9,11].indexOf(e.nodeType)){for(var n=document.createDocumentFragment(),a=0,o=t;a<o.length;a+=1){var i=o[a];$e.appendChild.call(n,i)}$e.appendChild.call(e,n)}},remove:function(e){$e.removeChild.call(e.parentNode,e)}},we={empty:function(){var e=this;ne();for(var t=0,r=H.copy(e);t<r.length;t+=1){r[t].$destroy()}ae(),H.empty(this)},pop:function(){if(0!==this.length){var e=H.pop(this);return e.$umount(),e}},push:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var n=e.state,a=e.key,o=e.anchor,i=[];ne();for(var s=0,u=t;s<u.length;s+=1){var c=u[s];H.push(i,c.$mount({parent:n,key:a}))}return 0===this.length?ke.after.apply(ke,[o].concat(i)):ke.after.apply(ke,[this[this.length-1].$avatar].concat(i)),ae(),H.push.apply(H,[this].concat(t))},remove:function(e){if(-1!==this.indexOf(e))return e.$umount(),e},reverse:function(e){var t=e.state,r=e.key,n=e.anchor;if(0===this.length)return this;var a=H.copy(this),o=[];ne();for(var i=a.length-1;i>=0;i--)a[i].$umount(),H.push(o,a[i].$mount({parent:t,key:r}));return H.push.apply(H,[this].concat(H.reverse(a))),ke.after.apply(ke,[n].concat(o)),ae(),this},shift:function(){if(0!==this.length){var e=H.shift(this);return e.$umount(),e}},sort:function(e,t){var r=e.state,n=e.key,a=e.anchor;if(0===this.length)return this;var o=H.copy(H.sort(this,t)),i=[];ne();for(var s=0,u=o;s<u.length;s+=1){var c=u[s];c.$umount(),H.push(i,c.$mount({parent:r,key:n}))}return H.push.apply(H,[this].concat(o)),ke.after.apply(ke,[a].concat(i)),ae(),this},splice:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];e.state,e.key,e.anchor;if(0===this.length)return this;var n=H.splice.apply(H,[H.copy(this)].concat(t));ne();for(var a=0,o=n;a<o.length;a+=1){o[a].$umount()}return ae(),n},unshift:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var n=e.state,a=e.key,o=e.anchor;if(0===this.length)return(l=this).push.apply(l,t).length;var i=[];ne();for(var s=0,u=t;s<u.length;s+=1){var c=u[s];if(c.$parent)return;c.$umount(),H.push(i,c.$mount({parent:n,key:a}))}return ke.after.apply(ke,[o].concat(i)),ae(),H.unshift.apply(H,[this].concat(t));var l}},xe=function(e,t){return Object.defineProperties(e,{empty:{value:we.empty},pop:{value:we.pop},push:{value:we.push.bind(e,t)},remove:{value:we.remove},reverse:{value:we.reverse.bind(e,t)},shift:{value:we.shift},sort:{value:we.sort.bind(e,t)},splice:{value:we.splice.bind(e,t)},unshift:{value:we.unshift.bind(e,t)}}),e},Ee=function(e){return Array.isArray(e)?"array":typeof e},De=function(e){var t=e.node,r=e.state,n=e.handlers,a=e.subscribers,o=e.innerData,i=e.element,s=document.createTextNode(""),u=le({bind:t,state:r,handlers:n,subscribers:a,innerData:o}),c=u.dataNode,l=u.handlerNode,p=u._key,f=function(){s.textContent=c[p]};l.push(f),te([f]),ke.append(i,s)},_e=function(e){var t=e.state,r=e.children,n=e.key,a=e.anchor,o=e.value;r[n]!==o&&(o&&(o.$parent,o.$element.contains(t.$element))||(ne(),r[n]&&r[n].$umount(),r[n]=o,o&&o.$mount({target:a,parent:t,option:"before",key:n}),ae()))},Te=function(e){var t=e.state,r=e.key,n=e.children,a=e.anchor;Object.defineProperty(t,r,{get:function(){return n[r]},set:function(e){_e({state:t,children:n,key:r,anchor:a,value:e})},enumerable:!0,configurable:!0})},Oe=function(e){var t=e.state,r=e.children,n=e.key,a=e.anchor,o=e.value;o=o?H.copy(o):[];var i=document.createDocumentFragment();if(ne(),r[n]){for(var s=0,u=o;s<u.length;s+=1){var c=u[s];if(c.$element.contains(t.$element))return;c.$umount(),ke.append(i,c.$mount({parent:t,key:n}))}for(var l=0,p=H.copy(r[n]);l<p.length;l+=1){p[l].$umount()}}else for(var f=0,d=o;f<d.length;f+=1){var h=d[f];ke.append(i,h.$mount({parent:t,key:n}))}r[n].length=0,H.push.apply(H,[r[n]].concat(o)),ke.after(a,i),ae()},Re=function(e){var t=e.state,r=e.key,n=e.children,a=e.anchor;n[r]=xe([],{state:t,key:r,anchor:a}),Object.defineProperty(t,r,{get:function(){return n[r]},set:function(e){n[r]&&H.equals(n[r],e)||Oe({state:t,children:n,key:r,anchor:a,value:e})},enumerable:!0,configurable:!0})},je=function(e){var t=e.node,r=e.nodeType,n=e.element,a=e.state,o=e.innerData,i=e.refs,s=e.children,u=e.handlers,c=e.subscribers,l=e.create;switch(r){case"string":ke.append(n,document.createTextNode(t));break;case"array":"object"===Ee(t[0])?ke.append(n,l({ast:t,state:a,innerData:o,refs:i,children:s,handlers:u,subscribers:c,create:l})):De({node:t,state:a,handlers:u,subscribers:c,innerData:o,element:n});break;case"object":var p=document.createTextNode("");if(0===t.t)Te({state:a,key:t.n,children:s,anchor:p});else{if(1!==t.t)throw new TypeError("Not a standard ef.js AST: Unknown mounting point type '"+t.t+"'");Re({state:a,key:t.n,children:s,anchor:p})}ke.append(n,p);break;default:throw new TypeError("Not a standard ef.js AST: Unknown node type '"+r+"'")}},Se=function(e){for(var t=e.ast,r=e.state,n=e.innerData,a=e.refs,o=e.children,i=e.handlers,s=e.subscribers,u=e.create,c=Ne({info:t[0],state:r,innerData:n,refs:a,handlers:i,subscribers:s}),l=1;l<t.length;l++)je({node:t[l],nodeType:Ee(t[l]),element:c,state:r,innerData:n,refs:a,children:o,handlers:i,subscribers:s,create:u});return c},Ae=function(e,t,r){var n=ue(e,r);H.remove(n,t)},Ce=function(e){ne();var t=X({},e);t.$data&&(X(this.$data,t.$data),delete t.$data),t.$methods&&(X(this.$methods,t.$methods),delete t.$methods),X(this,t),ae()},Pe=function(){var e=this,t=this,r=t.$element,n=t.$avatar;ne(),this.$umount();for(var a in e)e[a]=null,delete e[a];return re(function(){ke.remove(r),ke.remove(n)}),delete this.$element,delete this.$avatar,delete this.$parent,delete this.$key,delete this.$data,delete this.$methods,delete this.$refs,delete this.$mount,delete this.$umount,delete this.$subscribe,delete this.$unsubscribe,ae()},qe=function(){function e(e){var t=this,r={},n={},a={},o={},i={},s={},u={avatar:document.createTextNode(""),replace:[],parent:null,key:null},c=document.createDocumentFragment(),l=function(){if(u.replace.length>0){for(var e=0,t=u.replace;e<t.length;e+=1){var r=t[e];ke.remove(r)}H.empty(u.replace)}ke.before(u.avatar,u.element)};ne(),Object.defineProperties(this,{$element:{get:function(){return u.element},configurable:!0},$avatar:{get:function(){return u.avatar},configurable:!0},$parent:{get:function(){return u.parent},configurable:!0},$key:{get:function(){return u.key},configurable:!0},$methods:{get:function(){return o},set:function(e){X(o,e)},configurable:!0},$refs:{value:n,configurable:!0},$mount:{value:function(e){var t=e.target,r=e.option,n=e.parent,a=e.key;if("string"==typeof t&&(t=document.querySelector(t)),ne(),u.parent&&this.$umount(),n||(n=t),a||(a="__DIRECTMOUNT__"),u.parent=n,u.key=a,re(l),!t)return ae(),u.avatar;switch(r){case"before":ke.before(t,u.avatar);break;case"after":ke.after(t,u.avatar);break;case"replace":ke.before(t,u.avatar),u.replace.push(t);break;default:ke.append(t,u.avatar)}return ae()},configurable:!0},$umount:{value:function(){var e=u.parent,t=u.key;if(u.parent=null,u.key=null,ne(),e&&"__DIRECTMOUNT__"!==t&&e[t]){if(!Array.isArray(e[t]))return e[t]=null,ae();H.remove(e[t],this)}return ke.append(c,u.avatar),re(l),ae()},configurable:!0},$subscribe:{value:function(e,r){var n=e.split("."),o=le({bind:[n],state:t,handlers:i,subscribers:s,innerData:a}),u=o.dataNode,c=o.subscriberNode,l=o._key;r({state:t,value:u[l]}),c.push(r)},configurable:!0},$unsubscribe:{value:function(e,t){Ae(e,t,s)},configurable:!0}}),ie(["$data"],this,!1),u.element=Se({ast:e,state:this,innerData:a,refs:n,children:r,handlers:i,subscribers:s,create:Se}),ke.append(c,u.avatar),re(l),ae()}return e}();Object.defineProperties(qe.prototype,{$update:{value:Ce},$destroy:{value:Pe}});var Ie=B,Ue=function(e){var t=Ee(e);if("string"===t)e=z(e,Ie);else if("array"!==t)throw new TypeError("Cannot create new component without proper template or AST!");var r=e;return function(e){function t(t){ne(),e.call(this,r),t&&this.$update(t),ae()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(qe)},Fe=function(e){return ne(),ae(e(ne,ae))},Le=function(e){Ie=e},Me=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return Ue(J.apply(void 0,e))};e.create=Ue,e.inform=ne,e.exec=ae,e.bundle=Fe,e.setParser=Le,e.parseEft=B,e.t=Me,e.version="0.3.3-alpha.7",Object.defineProperty(e,"__esModule",{value:!0})});
