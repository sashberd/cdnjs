/*! OOjs UI v0.22.5 | http://oojs.mit-license.org */
!function(o){"use strict";o.ui.Toolbar=function(t,i,e){o.isPlainObject(t)&&void 0===e&&(t=(e=t).toolFactory,i=e.toolGroupFactory),e=e||{},o.ui.Toolbar.parent.call(this,e),o.EventEmitter.call(this),o.ui.mixin.GroupElement.call(this,e),this.toolFactory=t,this.toolGroupFactory=i,this.groups=[],this.tools={},this.position=e.position||"top",this.$bar=$("<div>"),this.$actions=$("<div>"),this.initialized=!1,this.narrowThreshold=null,this.onWindowResizeHandler=this.onWindowResize.bind(this),this.$element.add(this.$bar).add(this.$group).add(this.$actions).on("mousedown keydown",this.onPointerDown.bind(this)),this.$group.addClass("oo-ui-toolbar-tools"),e.actions&&this.$bar.append(this.$actions.addClass("oo-ui-toolbar-actions")),this.$bar.addClass("oo-ui-toolbar-bar").append(this.$group,'<div style="clear:both"></div>'),this.$element.addClass("oo-ui-toolbar oo-ui-toolbar-position-"+this.position).append(this.$bar)},o.inheritClass(o.ui.Toolbar,o.ui.Element),o.mixinClass(o.ui.Toolbar,o.EventEmitter),o.mixinClass(o.ui.Toolbar,o.ui.mixin.GroupElement),o.ui.Toolbar.prototype.getToolFactory=function(){return this.toolFactory},o.ui.Toolbar.prototype.getToolGroupFactory=function(){return this.toolGroupFactory},o.ui.Toolbar.prototype.onPointerDown=function(o){var t=$(o.target).closest(".oo-ui-widget"),i=this.$element.closest(".oo-ui-widget");if(!t.length||t[0]===i[0])return!1},o.ui.Toolbar.prototype.onWindowResize=function(){this.$element.toggleClass("oo-ui-toolbar-narrow",this.$bar.width()<=this.getNarrowThreshold())},o.ui.Toolbar.prototype.getNarrowThreshold=function(){return null===this.narrowThreshold&&(this.narrowThreshold=this.$group.width()+this.$actions.width()),this.narrowThreshold},o.ui.Toolbar.prototype.initialize=function(){this.initialized||(this.initialized=!0,$(this.getElementWindow()).on("resize",this.onWindowResizeHandler),this.onWindowResize())},o.ui.Toolbar.prototype.setup=function(t){var i,e,s,l,u=[];for(this.reset(),i=0,e=t.length;i<e;i++)"*"===(l=t[i]).include&&(void 0===l.type&&(l.type="list"),void 0===l.label&&(l.label=o.ui.msg("ooui-toolbar-more"))),s=this.getToolGroupFactory().lookup(l.type)?l.type:"bar",u.push(this.getToolGroupFactory().create(s,this,l));this.addItems(u)},o.ui.Toolbar.prototype.reset=function(){var o,t;for(this.groups=[],this.tools={},o=0,t=this.items.length;o<t;o++)this.items[o].destroy();this.clearItems()},o.ui.Toolbar.prototype.destroy=function(){$(this.getElementWindow()).off("resize",this.onWindowResizeHandler),this.reset(),this.$element.remove()},o.ui.Toolbar.prototype.isToolAvailable=function(o){return!this.tools[o]},o.ui.Toolbar.prototype.reserveTool=function(o){this.tools[o.getName()]=o},o.ui.Toolbar.prototype.releaseTool=function(o){delete this.tools[o.getName()]},o.ui.Toolbar.prototype.getToolAccelerator=function(){},o.ui.Tool=function(t,i){o.isPlainObject(t)&&void 0===i&&(t=(i=t).toolGroup),i=i||{},o.ui.Tool.parent.call(this,i),this.toolGroup=t,this.toolbar=this.toolGroup.getToolbar(),this.active=!1,this.$title=$("<span>"),this.$accel=$("<span>"),this.$link=$("<a>"),this.title=null,o.ui.mixin.IconElement.call(this,i),o.ui.mixin.FlaggedElement.call(this,i),o.ui.mixin.TabIndexedElement.call(this,$.extend({},i,{$tabIndexed:this.$link})),this.toolbar.connect(this,{updateState:"onUpdateState"}),this.$title.addClass("oo-ui-tool-title"),this.$accel.addClass("oo-ui-tool-accel").prop({dir:"ltr",lang:"en"}),this.$link.addClass("oo-ui-tool-link").append(this.$icon,this.$title,this.$accel).attr("role","button"),this.$element.data("oo-ui-tool",this).addClass("oo-ui-tool").addClass("oo-ui-tool-name-"+this.constructor.static.name.replace(/^([^/]+)\/([^/]+).*$/,"$1-$2")).toggleClass("oo-ui-tool-with-label",this.constructor.static.displayBothIconAndLabel).append(this.$link),this.setTitle(i.title||this.constructor.static.title)},o.inheritClass(o.ui.Tool,o.ui.Widget),o.mixinClass(o.ui.Tool,o.ui.mixin.IconElement),o.mixinClass(o.ui.Tool,o.ui.mixin.FlaggedElement),o.mixinClass(o.ui.Tool,o.ui.mixin.TabIndexedElement),o.ui.Tool.static.tagName="span",o.ui.Tool.static.name="",o.ui.Tool.static.group="",o.ui.Tool.static.title="",o.ui.Tool.static.displayBothIconAndLabel=!1,o.ui.Tool.static.autoAddToCatchall=!0,o.ui.Tool.static.autoAddToGroup=!0,o.ui.Tool.static.isCompatibleWith=function(){return!1},o.ui.Tool.prototype.onUpdateState=null,o.ui.Tool.prototype.onSelect=null,o.ui.Tool.prototype.isActive=function(){return this.active},o.ui.Tool.prototype.setActive=function(o){this.active=!!o,this.active?(this.$element.addClass("oo-ui-tool-active"),this.setFlags({progressive:!0})):(this.$element.removeClass("oo-ui-tool-active"),this.setFlags({progressive:!1}))},o.ui.Tool.prototype.setTitle=function(t){return this.title=o.ui.resolveMsg(t),this.updateTitle(),this},o.ui.Tool.prototype.getTitle=function(){return this.title},o.ui.Tool.prototype.getName=function(){return this.constructor.static.name},o.ui.Tool.prototype.updateTitle=function(){var o=this.toolGroup.constructor.static.titleTooltips,t=this.toolGroup.constructor.static.accelTooltips,i=this.toolbar.getToolAccelerator(this.constructor.static.name),e=[];this.$title.text(this.title),this.$accel.text(i),o&&"string"==typeof this.title&&this.title.length&&e.push(this.title),t&&"string"==typeof i&&i.length&&e.push(i),e.length?this.$link.attr("title",e.join(" ")):this.$link.removeAttr("title")},o.ui.Tool.prototype.destroy=function(){this.toolbar.disconnect(this),this.$element.remove()},o.ui.ToolGroup=function(t,i){o.isPlainObject(t)&&void 0===i&&(t=(i=t).toolbar),i=i||{},o.ui.ToolGroup.parent.call(this,i),o.ui.mixin.GroupElement.call(this,i),this.toolbar=t,this.tools={},this.pressed=null,this.autoDisabled=!1,this.include=i.include||[],this.exclude=i.exclude||[],this.promote=i.promote||[],this.demote=i.demote||[],this.onCapturedMouseKeyUpHandler=this.onCapturedMouseKeyUp.bind(this),this.$element.on({mousedown:this.onMouseKeyDown.bind(this),mouseup:this.onMouseKeyUp.bind(this),keydown:this.onMouseKeyDown.bind(this),keyup:this.onMouseKeyUp.bind(this),focus:this.onMouseOverFocus.bind(this),blur:this.onMouseOutBlur.bind(this),mouseover:this.onMouseOverFocus.bind(this),mouseout:this.onMouseOutBlur.bind(this)}),this.toolbar.getToolFactory().connect(this,{register:"onToolFactoryRegister"}),this.aggregate({disable:"itemDisable"}),this.connect(this,{itemDisable:"updateDisabled"}),this.$group.addClass("oo-ui-toolGroup-tools"),this.$element.addClass("oo-ui-toolGroup").append(this.$group),this.populate()},o.inheritClass(o.ui.ToolGroup,o.ui.Widget),o.mixinClass(o.ui.ToolGroup,o.ui.mixin.GroupElement),o.ui.ToolGroup.static.titleTooltips=!1,o.ui.ToolGroup.static.accelTooltips=!1,o.ui.ToolGroup.static.autoDisable=!0,o.ui.ToolGroup.static.name=null,o.ui.ToolGroup.prototype.isDisabled=function(){return this.autoDisabled||o.ui.ToolGroup.parent.prototype.isDisabled.apply(this,arguments)},o.ui.ToolGroup.prototype.updateDisabled=function(){var t,i=!0;if(this.constructor.static.autoDisable){for(t=this.items.length-1;t>=0;t--)if(!this.items[t].isDisabled()){i=!1;break}this.autoDisabled=i}o.ui.ToolGroup.parent.prototype.updateDisabled.apply(this,arguments)},o.ui.ToolGroup.prototype.onMouseKeyDown=function(t){if(!this.isDisabled()&&(t.which===o.ui.MouseButtons.LEFT||t.which===o.ui.Keys.SPACE||t.which===o.ui.Keys.ENTER)&&(this.pressed=this.getTargetTool(t),this.pressed))return this.pressed.setActive(!0),this.getElementDocument().addEventListener("mouseup",this.onCapturedMouseKeyUpHandler,!0),this.getElementDocument().addEventListener("keyup",this.onCapturedMouseKeyUpHandler,!0),!1},o.ui.ToolGroup.prototype.onCapturedMouseKeyUp=function(o){this.getElementDocument().removeEventListener("mouseup",this.onCapturedMouseKeyUpHandler,!0),this.getElementDocument().removeEventListener("keyup",this.onCapturedMouseKeyUpHandler,!0),this.onMouseKeyUp(o)},o.ui.ToolGroup.prototype.onMouseKeyUp=function(t){var i=this.getTargetTool(t);this.isDisabled()||!this.pressed||this.pressed!==i||t.which!==o.ui.MouseButtons.LEFT&&t.which!==o.ui.Keys.SPACE&&t.which!==o.ui.Keys.ENTER||(this.pressed.onSelect(),this.pressed=null,t.preventDefault(),t.stopPropagation()),this.pressed=null},o.ui.ToolGroup.prototype.onMouseOverFocus=function(o){var t=this.getTargetTool(o);this.pressed&&this.pressed===t&&this.pressed.setActive(!0)},o.ui.ToolGroup.prototype.onMouseOutBlur=function(o){var t=this.getTargetTool(o);this.pressed&&this.pressed===t&&this.pressed.setActive(!1)},o.ui.ToolGroup.prototype.getTargetTool=function(o){var t,i=$(o.target).closest(".oo-ui-tool-link");return i.length&&(t=i.parent().data("oo-ui-tool")),t&&!t.isDisabled()?t:null},o.ui.ToolGroup.prototype.onToolFactoryRegister=function(){this.populate()},o.ui.ToolGroup.prototype.getToolbar=function(){return this.toolbar},o.ui.ToolGroup.prototype.populate=function(){var o,t,i,e,s=this.toolbar.getToolFactory(),l={},u=[],n=[],r=this.toolbar.getToolFactory().getTools(this.include,this.exclude,this.promote,this.demote);for(o=0,t=r.length;o<t;o++)i=r[o],s.lookup(i)&&(this.toolbar.isToolAvailable(i)||this.tools[i])&&(this.toolbar.tools[i]=!0,(e=this.tools[i])||(this.tools[i]=e=s.create(i,this),e.updateTitle()),this.toolbar.reserveTool(e),u.push(e),l[i]=!0);for(i in this.tools)l[i]||(this.tools[i].destroy(),this.toolbar.releaseTool(this.tools[i]),n.push(this.tools[i]),delete this.tools[i]);n.length&&this.removeItems(n),u.length?this.$element.removeClass("oo-ui-toolGroup-empty"):this.$element.addClass("oo-ui-toolGroup-empty"),this.addItems(u),this.updateDisabled()},o.ui.ToolGroup.prototype.destroy=function(){var o;this.clearItems(),this.toolbar.getToolFactory().disconnect(this);for(o in this.tools)this.toolbar.releaseTool(this.tools[o]),this.tools[o].disconnect(this).destroy(),delete this.tools[o];this.$element.remove()},o.ui.ToolFactory=function(){o.ui.ToolFactory.parent.call(this)},o.inheritClass(o.ui.ToolFactory,o.Factory),o.ui.ToolFactory.prototype.getTools=function(t,i,e,s){var l,u,n,r,p,a=[],h={};for(n=o.simpleArrayDifference(this.extract(t),this.extract(i)),r=this.extract(e,h),p=this.extract(s,h),l=0,u=n.length;l<u;l++)h[n[l]]||a.push(n[l]);return r.concat(a).concat(p)},o.ui.ToolFactory.prototype.extract=function(t,i){var e,s,l,u,n,r=[];for(e=0,s=(t=Array.isArray(t)?t:[t]).length;e<s;e++)if("*"===(l=t[e]))for(u in this.registry)!(n=this.registry[u]).static.autoAddToCatchall||i&&i[u]||(r.push(u),i&&(i[u]=!0));else if("string"==typeof l&&(l={name:l}),o.isPlainObject(l))if(l.group)for(u in this.registry)(n=this.registry[u]).static.group!==l.group||!n.static.autoAddToGroup||i&&i[u]||(r.push(u),i&&(i[u]=!0));else!l.name||i&&i[l.name]||(r.push(l.name),i&&(i[l.name]=!0));return r},o.ui.ToolGroupFactory=function(){var t,i,e;for(o.Factory.call(this),t=0,i=(e=this.constructor.static.getDefaultClasses()).length;t<i;t++)this.register(e[t])},o.inheritClass(o.ui.ToolGroupFactory,o.Factory),o.ui.ToolGroupFactory.static.getDefaultClasses=function(){return[o.ui.BarToolGroup,o.ui.ListToolGroup,o.ui.MenuToolGroup]},o.ui.PopupTool=function(t,i){o.isPlainObject(t)&&void 0===i&&(t=(i=t).toolGroup),o.ui.PopupTool.parent.call(this,t,i),o.ui.mixin.PopupElement.call(this,i),this.popup.setPosition("bottom"===t.getToolbar().position?"above":"below"),this.$element.addClass("oo-ui-popupTool").append(this.popup.$element)},o.inheritClass(o.ui.PopupTool,o.ui.Tool),o.mixinClass(o.ui.PopupTool,o.ui.mixin.PopupElement),o.ui.PopupTool.prototype.onSelect=function(){return this.isDisabled()||this.popup.toggle(),this.setActive(!1),!1},o.ui.PopupTool.prototype.onUpdateState=function(){this.setActive(!1)},o.ui.ToolGroupTool=function(t,i){o.isPlainObject(t)&&void 0===i&&(t=(i=t).toolGroup),o.ui.ToolGroupTool.parent.call(this,t,i),this.innerToolGroup=this.createGroup(this.constructor.static.groupConfig),this.innerToolGroup.connect(this,{disable:"onToolGroupDisable"}),this.$link.remove(),this.$element.addClass("oo-ui-toolGroupTool").append(this.innerToolGroup.$element)},o.inheritClass(o.ui.ToolGroupTool,o.ui.Tool),o.ui.ToolGroupTool.static.groupConfig={},o.ui.ToolGroupTool.prototype.onSelect=function(){return this.innerToolGroup.setActive(!this.innerToolGroup.active),!1},o.ui.ToolGroupTool.prototype.onToolGroupDisable=function(o){this.setDisabled(o)},o.ui.ToolGroupTool.prototype.onUpdateState=function(){this.setActive(!1)},o.ui.ToolGroupTool.prototype.createGroup=function(t){return"*"===t.include&&void 0===t.label&&(t.label=o.ui.msg("ooui-toolbar-more")),this.toolbar.getToolGroupFactory().create("list",this.toolbar,t)},o.ui.BarToolGroup=function(t,i){o.isPlainObject(t)&&void 0===i&&(t=(i=t).toolbar),o.ui.BarToolGroup.parent.call(this,t,i),this.$element.addClass("oo-ui-barToolGroup")},o.inheritClass(o.ui.BarToolGroup,o.ui.ToolGroup),o.ui.BarToolGroup.static.titleTooltips=!0,o.ui.BarToolGroup.static.accelTooltips=!0,o.ui.BarToolGroup.static.name="bar",o.ui.PopupToolGroup=function(t,i){o.isPlainObject(t)&&void 0===i&&(t=(i=t).toolbar),i=$.extend({indicator:void 0===i.indicator?"bottom"===t.position?"up":"down":i.indicator},i),o.ui.PopupToolGroup.parent.call(this,t,i),this.active=!1,this.dragging=!1,this.onBlurHandler=this.onBlur.bind(this),this.$handle=$("<span>"),o.ui.mixin.IconElement.call(this,i),o.ui.mixin.IndicatorElement.call(this,i),o.ui.mixin.LabelElement.call(this,i),o.ui.mixin.TitledElement.call(this,i),o.ui.mixin.FlaggedElement.call(this,i),o.ui.mixin.ClippableElement.call(this,$.extend({},i,{$clippable:this.$group})),o.ui.mixin.TabIndexedElement.call(this,$.extend({},i,{$tabIndexed:this.$handle})),this.$handle.on({keydown:this.onHandleMouseKeyDown.bind(this),keyup:this.onHandleMouseKeyUp.bind(this),mousedown:this.onHandleMouseKeyDown.bind(this),mouseup:this.onHandleMouseKeyUp.bind(this)}),this.$handle.addClass("oo-ui-popupToolGroup-handle").attr("role","button").append(this.$icon,this.$label,this.$indicator),void 0!==i.header&&this.$group.prepend($("<span>").addClass("oo-ui-popupToolGroup-header").text(i.header)),this.$element.addClass("oo-ui-popupToolGroup").prepend(this.$handle)},o.inheritClass(o.ui.PopupToolGroup,o.ui.ToolGroup),o.mixinClass(o.ui.PopupToolGroup,o.ui.mixin.IconElement),o.mixinClass(o.ui.PopupToolGroup,o.ui.mixin.IndicatorElement),o.mixinClass(o.ui.PopupToolGroup,o.ui.mixin.LabelElement),o.mixinClass(o.ui.PopupToolGroup,o.ui.mixin.TitledElement),o.mixinClass(o.ui.PopupToolGroup,o.ui.mixin.FlaggedElement),o.mixinClass(o.ui.PopupToolGroup,o.ui.mixin.ClippableElement),o.mixinClass(o.ui.PopupToolGroup,o.ui.mixin.TabIndexedElement),o.ui.PopupToolGroup.prototype.setDisabled=function(){o.ui.PopupToolGroup.parent.prototype.setDisabled.apply(this,arguments),this.isDisabled()&&this.isElementAttached()&&this.setActive(!1)},o.ui.PopupToolGroup.prototype.onBlur=function(o){$(o.target).closest(".oo-ui-popupToolGroup")[0]!==this.$element[0]&&this.setActive(!1)},o.ui.PopupToolGroup.prototype.onMouseKeyUp=function(t){return this.isDisabled()||!this.pressed||this.pressed!==this.getTargetTool(t)||t.which!==o.ui.MouseButtons.LEFT&&t.which!==o.ui.Keys.SPACE&&t.which!==o.ui.Keys.ENTER||this.setActive(!1),o.ui.PopupToolGroup.parent.prototype.onMouseKeyUp.call(this,t)},o.ui.PopupToolGroup.prototype.onHandleMouseKeyUp=function(t){if(!this.isDisabled()&&(t.which===o.ui.MouseButtons.LEFT||t.which===o.ui.Keys.SPACE||t.which===o.ui.Keys.ENTER))return!1},o.ui.PopupToolGroup.prototype.onHandleMouseKeyDown=function(t){if(!this.isDisabled()&&(t.which===o.ui.MouseButtons.LEFT||t.which===o.ui.Keys.SPACE||t.which===o.ui.Keys.ENTER))return this.setActive(!this.active),!1},o.ui.PopupToolGroup.prototype.setActive=function(o){var t,i;o=!!o,this.active!==o&&(this.active=o,o?(this.getElementDocument().addEventListener("mouseup",this.onBlurHandler,!0),this.getElementDocument().addEventListener("keyup",this.onBlurHandler,!0),this.$clippable.css("left",""),this.$element.addClass("oo-ui-popupToolGroup-active oo-ui-popupToolGroup-left"),this.toggleClipping(!0),this.isClippedHorizontally()&&(this.toggleClipping(!1),this.$element.removeClass("oo-ui-popupToolGroup-left").addClass("oo-ui-popupToolGroup-right"),this.toggleClipping(!0)),this.isClippedHorizontally()&&(t=this.$clippableScrollableContainer.width(),i=this.$clippableScrollableContainer.offset().left,this.toggleClipping(!1),this.$element.removeClass("oo-ui-popupToolGroup-right"),this.$clippable.css({left:-(this.$element.offset().left-i),width:t}))):(this.getElementDocument().removeEventListener("mouseup",this.onBlurHandler,!0),this.getElementDocument().removeEventListener("keyup",this.onBlurHandler,!0),this.$element.removeClass("oo-ui-popupToolGroup-active oo-ui-popupToolGroup-left  oo-ui-popupToolGroup-right"),this.toggleClipping(!1)))},o.ui.ListToolGroup=function(t,i){o.isPlainObject(t)&&void 0===i&&(t=(i=t).toolbar),i=i||{},this.allowCollapse=i.allowCollapse,this.forceExpand=i.forceExpand,this.expanded=void 0!==i.expanded&&i.expanded,this.collapsibleTools=[],o.ui.ListToolGroup.parent.call(this,t,i),this.$element.addClass("oo-ui-listToolGroup")},o.inheritClass(o.ui.ListToolGroup,o.ui.PopupToolGroup),o.ui.ListToolGroup.static.name="list",o.ui.ListToolGroup.prototype.populate=function(){var t,i,e=[];for(o.ui.ListToolGroup.parent.prototype.populate.call(this),void 0!==this.allowCollapse?e=this.allowCollapse:void 0!==this.forceExpand&&(e=o.simpleArrayDifference(Object.keys(this.tools),this.forceExpand)),this.collapsibleTools=[],t=0,i=e.length;t<i;t++)void 0!==this.tools[e[t]]&&this.collapsibleTools.push(this.tools[e[t]]);this.$group.append(this.getExpandCollapseTool().$element),this.getExpandCollapseTool().toggle(0!==this.collapsibleTools.length),this.updateCollapsibleState()},o.ui.ListToolGroup.prototype.getExpandCollapseTool=function(){var t;return void 0===this.expandCollapseTool&&(t=function(){t.parent.apply(this,arguments)},o.inheritClass(t,o.ui.Tool),t.prototype.onSelect=function(){this.toolGroup.expanded=!this.toolGroup.expanded,this.toolGroup.updateCollapsibleState(),this.setActive(!1)},t.prototype.onUpdateState=function(){},t.static.name="more-fewer",this.expandCollapseTool=new t(this)),this.expandCollapseTool},o.ui.ListToolGroup.prototype.onMouseKeyUp=function(t){return!$(t.target).closest(".oo-ui-tool-name-more-fewer").length||t.which!==o.ui.MouseButtons.LEFT&&t.which!==o.ui.Keys.SPACE&&t.which!==o.ui.Keys.ENTER?o.ui.ListToolGroup.parent.prototype.onMouseKeyUp.call(this,t):o.ui.ListToolGroup.parent.parent.prototype.onMouseKeyUp.call(this,t)},o.ui.ListToolGroup.prototype.updateCollapsibleState=function(){var t,i;for(this.getExpandCollapseTool().setIcon(this.expanded?"collapse":"expand").setTitle(o.ui.msg(this.expanded?"ooui-toolgroup-collapse":"ooui-toolgroup-expand")),t=0,i=this.collapsibleTools.length;t<i;t++)this.collapsibleTools[t].toggle(this.expanded);this.clip()},o.ui.MenuToolGroup=function(t,i){o.isPlainObject(t)&&void 0===i&&(t=(i=t).toolbar),i=i||{},o.ui.MenuToolGroup.parent.call(this,t,i),this.toolbar.connect(this,{updateState:"onUpdateState"}),this.$element.addClass("oo-ui-menuToolGroup")},o.inheritClass(o.ui.MenuToolGroup,o.ui.PopupToolGroup),o.ui.MenuToolGroup.static.name="menu",o.ui.MenuToolGroup.prototype.onUpdateState=function(){var o,t=[];for(o in this.tools)this.tools[o].isActive()&&t.push(this.tools[o].getTitle());this.setLabel(t.join(", ")||" ")}}(OO);
//# sourceMappingURL=oojs-ui-toolbars.min.js.map