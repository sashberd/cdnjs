!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("inferno"),require("stream")):"function"==typeof define&&define.amd?define(["exports","inferno","stream"],t):t(e["inferno-server"]=e["inferno-server"]||{},e.Inferno,e.stream)}(this,function(e,t,r){"use strict";function n(e){var t=typeof e;return"string"===t||"number"===t}function o(e){return c(e)||a(e)}function i(e){return a(e)||e===!1||p(e)||c(e)}function u(e){return"function"==typeof e}function s(e){return"number"==typeof e}function a(e){return null===e}function p(e){return e===!0}function c(e){return void 0===e}function l(e){throw e||(e="a runtime error occured! Use Inferno in development environment to find the error."),new Error("Inferno Error: "+e)}function d(e){for(var t=arguments,r=1,n=arguments.length;r<n;r++){var i=t[r];if(!o(i))for(var u=Object.keys(i),s=0,a=u.length;s<a;s++){var p=u[s];e[p]=i[p]}}return e}function f(e){return String(e).replace(/[<>"'&]/g,w)}function h(e){return e.replace(/[A-Z]/g,"-$&").toLowerCase().replace(/^ms-/,"-ms-")}function v(e){return!!C[e]}function m(e){if(n(e))return e;var r="";for(var i in e){var u=e[i],a=s(u)&&!t.internal_isUnitlessNumber[i]?"px":"";o(u)||(r+=h(i)+":"+f(u)+a+";")}return r}function y(e,r,s,c){var h=e.flags,g=e.type,T=e.props||t.EMPTY_OBJ,S=e.children;if(28&h){if(4&h){var _=new g(T,s),Q=_.getChildContext();o(Q)||(s=d({},s,Q)),_.props===t.EMPTY_OBJ&&(_.props=T),_.context=s,_._pendingSetState=!0,_._unmounted=!1,u(_.componentWillMount)&&_.componentWillMount();var M=_.render(T,e.context);return _._pendingSetState=!1,i(M)?"<!--!-->":y(M,e,s,!0)}var N=g(T,s);return i(N)?"<!--!-->":y(N,e,s,!0)}if(3970&h){var b,k="<"+g,P=v(g);if(!a(T))for(var w in T){var C=T[w];"dangerouslySetInnerHTML"===w?b=C.__html:"style"===w?k+=' style="'+m(T.style)+'"':"className"!==w||o(C)?"children"===w||("defaultValue"===w?T.value||(k+=' value="'+f(C)+'"'):"defaultChecked"===w?T.checked||(k+=' checked="'+C+'"'):"value"===w&&r.props&&r.props.value?C===r.props.value&&(k+=" selected"):n(C)?k+=" "+w+'="'+f(C)+'"':p(C)&&(k+=" "+w)):k+=' class="'+f(C)+'"'}if(P)k+=">";else{if(k+=">",i(S))b&&(k+=b);else if(x(S))for(var A=0,j=S.length;A<j;A++){var E=S[A];n(E)?k+=""===E?" ":f(E):i(E)||(k+=y(E,e,s,0===A))}else k+=n(S)?""===S?" ":f(S):y(S,e,s,!0);P||(k+="</"+g+">")}return k}if(1&h)return(c?"":"<!---->")+(""===S?" ":f(S));l()}function g(e){return y(e,{},{},!0)}function T(e){return y(e,{},{},!0)}function S(e){if(n(e))return e;var r=[];for(var i in e){var u=e[i],a=s(u)&&!t.internal_isUnitlessNumber[i]?"px":"";o(u)||r.push(h(i)+":"+f(u)+a+";")}return r.join()}function _(e){var t=[];return(e&&Object.keys(e)||[]).forEach(function(r,o){var i=e[r];switch(r){case"children":case"dangerouslySetInnerHTML":case"className":case"style":return;default:n(i)?t.push(f(r)+'="'+f(i)+'"'):p(i)&&t.push(f(r))}}),t}function Q(e){return new A(e,!1)}function M(e){return new A(e,!0)}function N(e){if(n(e))return e;var r="";for(var i in e){var u=e[i],a=s(u)&&!t.internal_isUnitlessNumber[i]?"px":"";o(u)||(r+=h(i)+":"+f(u)+a+";")}return r}function b(e){return new j(e,!1)}function k(e){return new j(e,!0)}var x=Array.isArray,P={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;","&":"&amp;"},w=function(e){return P[e]||e},C={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},A=function(e){function t(t,r){e.call(this),this.started=!1,this.initNode=t,this.staticMarkup=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){var e=this;this.started||(this.started=!0,Promise.resolve().then(function(){return e.renderNode(e.initNode,null,e.staticMarkup)}).then(function(){e.push(null)}).catch(function(t){e.emit("error",t)}))},t.prototype.renderNode=function(e,t,r){if(!i(e)){var n=e.flags;return 28&n?this.renderComponent(e,r,t,4&n):3970&n?this.renderElement(e,r,t):this.renderText(e,r,t)}},t.prototype.renderComponent=function(e,t,r,n){var i=this,u=e.type,s=e.props;if(!n)return this.renderNode(u(s),r,t);var a=new u(s),p=a.getChildContext();return o(p)||(r=d({},r,p)),a.context=r,a._pendingSetState=!0,Promise.resolve(a.componentWillMount()).then(function(){var e=a.render();return a._pendingSetState=!1,i.renderNode(e,r,t)})},t.prototype.renderChildren=function(e,t){var r=this;if(n(e))return this.push(f(e));if(e){var o=x(e);if(!o&&!i(e))return this.renderNode(e,t,!1);if(!o)throw new Error("invalid component");return e.reduce(function(e,o){return e.then(function(e){var u=n(o);return u?(e===!0&&r.push("<!---->"),u&&r.push(f(o)),!0):x(o)?(r.push("<!---->"),Promise.resolve(r.renderChildren(o)).then(function(){return r.push("<!--!-->"),!0})):i(o)?void 0:(1&o.flags&&(e&&r.push("<!---->"),e=!0),Promise.resolve(r.renderNode(o,t,!1)).then(function(e){return!!(1&o.flags)}))})},Promise.resolve(!1))}},t.prototype.renderText=function(e,t,r){var n=this;return Promise.resolve().then(function(t){return n.push(e.children),t})},t.prototype.renderElement=function(e,t,r){var n=this,i=e.type,u=e.props,s=_(u),a="";if(u){var p=u.className;o(p)||s.push('class="'+f(p)+'"');var c=u.style;c&&s.push('style="'+S(c)+'"'),u.dangerouslySetInnerHTML&&(a=u.dangerouslySetInnerHTML.__html)}if(t&&s.push("data-infernoroot"),this.push("<"+i+(s.length>0?" "+s.join(" "):"")+">"),!v(i))return a?(this.push(a),void this.push("</"+i+">")):Promise.resolve(this.renderChildren(e.children,r)).then(function(){n.push("</"+i+">")})},t}(r.Readable),j=function(e){function r(t,r){e.call(this),this.started=!1,this.collector=[1/0],this.promises=[],this.pushQueue=this.pushQueue.bind(this),t&&this.renderVNodeToQueue(t,null,r,null)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype._read=function(){setTimeout(this.pushQueue,0)},r.prototype.addToQueue=function(e,t){if(o(t))"string"==typeof e&&this.collector.length-1==0?this.push(e):"string"==typeof e&&"string"==typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"==typeof this.promises[t][r]&&"string"==typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},r.prototype.pushQueue=function(){var e=this.collector[0];if("string"==typeof e)this.push(e),this.collector.shift();else if(e&&("object"==typeof e||u(e))&&u(e.then)){var t=this;e.then(function(e){(r=t.collector).splice.apply(r,[0,1].concat(t.promises[e])),t.promises[e]=null,setTimeout(t.pushQueue,0);var r}),this.collector[0]=null}else e===1/0&&this.emit("end")},r.prototype.renderVNodeToQueue=function(e,r,s,c){var h=this;if(i(e))return void this.addToQueue("<!--!-->",c);var m=e.flags,y=e.type,g=e.props||t.EMPTY_OBJ,T=e.children;if(28&m){if(4&m){var S=new y(g,r),_=S.getChildContext();if(o(_)||(r=d({},r,_)),S.props===t.EMPTY_OBJ&&(S.props=g),S.context=r,S._pendingSetState=!0,S._unmounted=!1,u(S.componentWillMount)&&S.componentWillMount(),u(S.getInitialProps)){var Q=S.getInitialProps(S.props,S.context);if(Q){if(Promise.resolve(Q)===Q){var M=this.promises.push([])-1;return void this.addToQueue(Q.then(function(e){return S._pendingSetState=!1,"object"==typeof e&&(S.props=d({},S.props,e)),h.renderVNodeToQueue(S.render(S.props,S.context),S.context,!0,M),setTimeout(h.pushQueue,0),M}),c)}S.props=d({},S.props,Q)}}var b=S.render(g,e.context);S._pendingSetState=!1,this.renderVNodeToQueue(b,r,!0,c)}else{var k=y(g,r);this.renderVNodeToQueue(k,r,!0,c)}}else if(3970&m){var P,w="<"+y,C=v(y);if(!a(g))for(var A in g){var j=g[A];"dangerouslySetInnerHTML"===A?P=j.__html:"style"===A?w+=' style="'+N(g.style)+'"':"className"!==A||o(j)?"children"===A||("defaultValue"===A?g.value||(w+=' value="'+f(j)+'"'):"defaultChecked"===A?g.checked||(w+=' checked="'+j+'"'):n(j)?w+=" "+A+'="'+f(j)+'"':p(j)&&(w+=" "+A)):w+=' class="'+f(j)+'"'}if(C)this.addToQueue(w+">",c);else{if(w+=">",i(T)){if(P)return void this.addToQueue(w+P+"</"+y+">",c)}else{if(!x(T))return n(T)?void this.addToQueue(w+f(T)+"</"+y+">",c):(this.addToQueue(w,c),this.renderVNodeToQueue(T,r,!0,c),void this.addToQueue("</"+y+">",c));this.addToQueue(w,c),w="";for(var E=0,I=T.length;E<I;E++){var O=T[E];n(O)?h.addToQueue(f(T),c):i(O)||h.renderVNodeToQueue(O,r,0===E,c)}}C||this.addToQueue(w+"</"+y+">",c)}}else 1&m?this.addToQueue((s?"":"<!---->")+f(T),c):l()},r}(r.Readable),E={renderToString:g,renderToStaticMarkup:T,streamAsString:Q,streamAsStaticMarkup:M,RenderStream:A,RenderQueueStream:j,streamQueueAsString:b,streamQueueAsStaticMarkup:k};e.default=E,e.renderToString=g,e.renderToStaticMarkup=T,e.streamAsString=Q,e.streamAsStaticMarkup=M,e.RenderStream=A,e.RenderQueueStream=j,e.streamQueueAsString=b,e.streamQueueAsStaticMarkup=k,Object.defineProperty(e,"__esModule",{value:!0})});
