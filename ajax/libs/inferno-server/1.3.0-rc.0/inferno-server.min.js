!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("inferno"),require("stream")):"function"==typeof define&&define.amd?define(["exports","inferno","stream"],t):t(e["inferno-server"]=e["inferno-server"]||{},e.Inferno,e.stream)}(this,function(e,t,r){"use strict";function n(e){var t=typeof e;return"string"===t||"number"===t}function o(e){return c(e)||a(e)}function i(e){return a(e)||e===!1||p(e)||c(e)}function s(e){return"function"==typeof e}function u(e){return"number"==typeof e}function a(e){return null===e}function p(e){return e===!0}function c(e){return void 0===e}function l(e){throw e||(e=k),new Error("Inferno Error: "+e)}function d(e,t){for(var r in e)c(t[r])&&(t[r]=e[r])}function f(e){return String(e).replace(/[<>"'&]/g,C)}function h(e){return e.replace(A,"-$&").toLowerCase().replace(I,"-ms-")}function v(e){return!!O[e]}function m(e){if(n(e))return e;var r="";for(var i in e){var s=e[i],a=u(s)&&!t.internal_isUnitlessNumber[i]?"px":"";o(s)||(r+=h(i)+":"+f(s)+a+";")}return r}function y(e,t,r,u){var c=e.flags,h=e.type,g=e.props||w,S=e.children;if(28&c){var T=4&c;if(o(h.defaultProps)||(d(h.defaultProps,g),e.props=g),T){var Q=new h(g,r),_=Q.getChildContext();o(_)||(r=Object.assign({},r,_)),Q.props===w&&(Q.props=g),Q.context=r,Q._pendingSetState=!0,Q._unmounted=!1,s(Q.componentWillMount)&&Q.componentWillMount();var b=Q.render(g,e.context);return Q._pendingSetState=!1,i(b)?"<!--!-->":y(b,e,r,!0)}var N=h(g,r);return i(N)?"<!--!-->":y(N,e,r,!0)}if(3970&c){var x,M="<"+h,k=v(h);if(!a(g))for(var P in g){var C=g[P];"dangerouslySetInnerHTML"===P?x=C.__html:"style"===P?M+=' style="'+m(g.style)+'"':"className"!==P||o(C)?"children"===P||("defaultValue"===P?g.value||(M+=' value="'+f(C)+'"'):"defaultChecked"===P?g.checked||(M+=' checked="'+C+'"'):"value"===P&&t.props&&t.props.value?C===t.props.value&&(M+=" selected"):n(C)?M+=" "+P+'="'+f(C)+'"':p(C)&&(M+=" "+P)):M+=' class="'+f(C)+'"'}if(k)M+=">";else{if(M+=">",i(S))x&&(M+=x);else if(j(S))for(var A=0,I=S.length;A<I;A++){var O=S[A];n(O)?M+=""===O?" ":f(O):i(O)||(M+=y(O,e,r,0===A))}else M+=n(S)?""===S?" ":f(S):y(S,e,r,!0);k||(M+="</"+h+">")}return M}return 1&c?(u?"":"<!---->")+(""===S?" ":f(S)):void l()}function g(e){return y(e,{},{},!0)}function S(e){return y(e,{},{},!0)}function T(e){if(n(e))return e;var r=[];for(var i in e){var s=e[i],a=u(s)&&!t.internal_isUnitlessNumber[i]?"px":"";o(s)||r.push(h(i)+":"+f(s)+a+";")}return r.join()}function Q(e){var t=[],r=e&&Object.keys(e)||[];return r.forEach(function(r,o){var i=e[r];switch(r){case"dangerouslySetInnerHTML":case"className":case"style":return;default:n(i)?t.push(f(r)+'="'+f(i)+'"'):p(i)&&t.push(f(r))}}),t}function _(e){return new V(e,!1)}function b(e){return new V(e,!0)}function N(e){if(n(e))return e;var r="";for(var i in e){var s=e[i],a=u(s)&&!t.internal_isUnitlessNumber[i]?"px":"";o(s)||(r+=h(i)+":"+f(s)+a+";")}return r}function x(e){return new E(e,!1)}function M(e){return new E(e,!0)}var k="a runtime error occured! Use Inferno in development environment to find the error.",j=Array.isArray,w={},P={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;","&":"&amp;"},C=function(e){return P[e]||e},A=/[A-Z]/g,I=/^ms-/,O={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},V=function(e){function t(t,r){e.call(this),this.started=!1,this.initNode=t,this.staticMarkup=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){var e=this;this.started||(this.started=!0,Promise.resolve().then(function(){return e.renderNode(e.initNode,null,e.staticMarkup)}).then(function(){e.push(null)}).catch(function(t){e.emit("error",t)}))},t.prototype.renderNode=function(e,t,r){if(!i(e)){var n=e.flags;return 28&n?this.renderComponent(e,r,t,4&n):3970&n?this.renderElement(e,r,t):this.renderText(e,r,t)}},t.prototype.renderComponent=function(e,t,r,n){var i=this,s=e.type,u=e.props;if(!n)return this.renderNode(s(u),r,t);var a=new s(u),p=a.getChildContext();return o(p)||(r=Object.assign({},r,p)),a.context=r,a._pendingSetState=!0,Promise.resolve(a.componentWillMount()).then(function(){var e=a.render();return a._pendingSetState=!1,i.renderNode(e,r,t)})},t.prototype.renderChildren=function(e,t){var r=this;if(n(e))return this.push(f(e));if(e){var o=j(e);if(!o&&!i(e))return this.renderNode(e,t,!1);if(!o)throw new Error("invalid component");return e.reduce(function(e,o){return e.then(function(e){var s=n(o);return s?(e===!0&&r.push("<!---->"),s&&r.push(f(o)),!0):j(o)?(r.push("<!---->"),Promise.resolve(r.renderChildren(o)).then(function(){return r.push("<!--!-->"),!0})):i(o)?void 0:(1&o.flags&&(e&&r.push("<!---->"),e=!0),r.renderNode(o,t,!1).then(function(e){return!!(1&o.flags)}))})},Promise.resolve(!1))}},t.prototype.renderText=function(e,t,r){var n=this;return Promise.resolve().then(function(t){return n.push(e.children),t})},t.prototype.renderElement=function(e,t,r){var n=this,i=e.type,s=e.props,u=Q(s),a="";if(s){var p=s.className;o(p)||u.push('class="'+f(p)+'"');var c=s.style;c&&u.push('style="'+T(c)+'"'),s.dangerouslySetInnerHTML&&(a=s.dangerouslySetInnerHTML.__html)}if(t&&u.push("data-infernoroot"),this.push("<"+i+(u.length>0?" "+u.join(" "):"")+">"),!v(i))return a?(this.push(a),void this.push("</"+i+">")):Promise.resolve(this.renderChildren(e.children,r)).then(function(){n.push("</"+i+">")})},t}(r.Readable),E=function(e){function t(t,r){e.call(this),this.started=!1,this.collector=[1/0],this.promises=[],this.pushQueue=this.pushQueue.bind(this),t&&this.renderVNodeToQueue(t,null,r,null)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){setTimeout(this.pushQueue,0)},t.prototype.addToQueue=function(e,t){if(o(t))"string"==typeof e&&this.collector.length-1===0?this.push(e):"string"==typeof e&&"string"==typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"==typeof this.promises[t][r]&&"string"==typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},t.prototype.pushQueue=function(){var e=this.collector[0];if("string"==typeof e)this.push(e),this.collector.shift();else if(e&&("object"==typeof e||s(e))&&s(e.then)){var t=this;e.then(function(e){(r=t.collector).splice.apply(r,[0,1].concat(t.promises[e])),t.promises[e]=null,setTimeout(t.pushQueue,0);var r}),this.collector[0]=null}else e===1/0&&this.emit("end")},t.prototype.renderVNodeToQueue=function(e,t,r,u){var c=this,h=e.flags,m=e.type,y=e.props||w,g=e.children;if(28&h){var S=4&h;if(o(m.defaultProps)||(d(m.defaultProps,y),e.props=y),S){var T=new m(y,t),Q=T.getChildContext();if(o(Q)||(t=Object.assign({},t,Q)),T.props===w&&(T.props=y),T.context=t,T._pendingSetState=!0,T._unmounted=!1,s(T.componentWillMount)&&T.componentWillMount(),s(T.getInitialProps)){var _=T.getInitialProps(T.props,T.context);if(_){if(Promise.resolve(_)===_){var b=this.promises.push([])-1;return void this.addToQueue(_.then(function(e){return T._pendingSetState=!1,"object"==typeof e&&(T.props=Object.assign({},T.props,e)),c.renderVNodeToQueue(T.render(T.props,T.context),T.context,!0,b),setTimeout(c.pushQueue,0),b}),u)}T.props=Object.assign({},T.props,_)}}var x=T.render(y,e.context);T._pendingSetState=!1,i(x)&&this.addToQueue("<!--!-->",u),this.renderVNodeToQueue(x,t,!0,u)}else{var M=m(y,t);i(M)&&this.addToQueue("<!--!-->",u),this.renderVNodeToQueue(M,t,!0,u)}}else if(3970&h){var k,P="<"+m,C=v(m);if(!a(y))for(var A in y){var I=y[A];"dangerouslySetInnerHTML"===A?k=I.__html:"style"===A?P+=' style="'+N(y.style)+'"':"className"!==A||o(I)?n(I)?P+=" "+A+'="'+f(I)+'"':p(I)&&(P+=" "+A):P+=' class="'+f(I)+'"'}if(C)this.addToQueue(P+">",u);else{if(P+=">",i(g)){if(k)return void this.addToQueue(P+k+"</"+m+">",u)}else{if(!j(g))return n(g)?void this.addToQueue(P+f(g)+"</"+m+">",u):(this.addToQueue(P,u),this.renderVNodeToQueue(g,t,!0,u),void this.addToQueue("</"+m+">",u));this.addToQueue(P,u),P="";for(var O=0,V=g.length;O<V;O++){var E=g[O];n(E)?c.addToQueue(f(g),u):i(E)||c.renderVNodeToQueue(E,t,0===O,u)}}C||this.addToQueue(P+"</"+m+">",u)}}else 1&h?this.addToQueue((r?"":"<!---->")+f(g),u):l()},t}(r.Readable),L={renderToString:g,renderToStaticMarkup:S,streamAsString:_,streamAsStaticMarkup:b,RenderStream:V,RenderQueueStream:E,streamQueueAsString:x,streamQueueAsStaticMarkup:M};e.default=L,e.renderToString=g,e.renderToStaticMarkup=S,e.streamAsString=_,e.streamAsStaticMarkup=b,e.RenderStream=V,e.RenderQueueStream=E,e.streamQueueAsString=x,e.streamQueueAsStaticMarkup=M,Object.defineProperty(e,"__esModule",{value:!0})});
