!(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("inferno"),require("stream")):"function"==typeof define&&define.amd?define(["exports","inferno","stream"],t):t((e.Inferno=e.Inferno||{},e.Inferno.Server=e.Inferno.Server||{}),e.Inferno,e.stream)})(this,(function(e,t,r){"use strict";function n(e){var t=typeof e;return"string"===t||"number"===t}function o(e){return l(e)||c(e)}function i(e){return c(e)||!1===e||d(e)||l(e)}function s(e){return"function"==typeof e}function u(e){return"string"==typeof e}function a(e){return"number"==typeof e}function c(e){return null===e}function d(e){return!0===e}function l(e){return void 0===e}function p(e){throw e||(e=N),new Error("Inferno Error: "+e)}function h(e,t){var r={};if(e)for(var n in e)r[n]=e[n];if(t)for(var o in t)r[o]=t[o];return r}function f(e){var t,r=e,n="",o=0;for(t=0;t<e.length;t++){switch(e.charCodeAt(t)){case 34:n="&quot;";break;case 39:n="&#039;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t>o&&(o?r+=e.slice(o,t):r=e.slice(o,t)),r+=n,o=t+1}return o&&t!==o?r+e.slice(o,t):r}function v(e){return C.hasOwnProperty(e)?C[e]:C[e]=e.replace(M,"-$&").toLowerCase()+":"}function m(e){if(u(e))return e;var r="";for(var n in e){var o=e[n];u(o)?r+=""+v(n)+o+";":a(o)&&(r+=""+v(n)+o+(t.internal_isUnitlessNumber.has(n)?"":"px")+";")}return r}function y(e){for(var t=[],r=e&&Object.keys(e)||[],n=0,o=r.length;n<o;n++){var i=r[n];if("children"!==i&&"dangerouslySetInnerHTML"!==i&&"style"!==i){var s=e[i];u(s)?t.push(i+'="'+f(s)+'"'):a(s)?t.push(i+'="'+s+'"'):d(s)&&t.push(i)}}return t}function g(e,r,n,l){var v=e.flags,y=e.type,S=e.props||t.EMPTY_OBJ,T=e.children;if((28&v)>0){if(4&v){var x=new y(S,n);x._blockSetState=!1;var _;o(x.getChildContext)||(_=x.getChildContext()),o(_)||(n=h(n,_)),x.props===t.EMPTY_OBJ&&(x.props=S),x.context=n,x._pendingSetState=!0,x._unmounted=!1,s(x.componentWillMount)&&x.componentWillMount();var b=x.render(S,e.context);return x._pendingSetState=!1,i(b)?"\x3c!--!--\x3e":g(b,e,n,!0)}var Q=y(S,n);return i(Q)?"\x3c!--!--\x3e":g(Q,e,n,!0)}if((3970&v)>0){var N,M="<"+y,C=w.has(y);if(o(e.className)||(M+=' class="'+f(e.className)+'"'),!c(S))for(var j in S){var P=S[j];"dangerouslySetInnerHTML"===j?N=P.__html:"style"===j?M+=' style="'+m(S.style)+'"':"children"===j||("defaultValue"===j?S.value||(M+=' value="'+f(P)+'"'):"defaultChecked"===j?S.checked||(M+=' checked="'+P+'"'):"option"===y&&"value"===j?P===r.props.value&&(M+=" selected"):u(P)?M+=" "+j+'="'+f(P)+'"':a(P)?M+=" "+j+'="'+P+'"':d(P)&&(M+=" "+j))}if(C)M+=">";else{if(M+=">",i(T))N&&(M+=N);else if(u(T))M+=""===T?" ":f(T);else if(a(T))M+=T+"";else if(k(T))for(var I=0,O=T.length;I<O;I++){var V=T[I];u(V)?M+=""===V?" ":f(V):a(V)?M+=V:i(V)||(M+=g(V,e,n,0===I))}else M+=g(T,e,n,!0);C||(M+="</"+y+">")}return M}if((1&v)>0)return(l?"":"\x3c!----\x3e")+(""===T?" ":f(T));p("object"==typeof e?"renderToString() received an object that's not a valid VNode, you should stringify it first. Object: \""+JSON.stringify(e)+'".':'renderToString() expects a valid VNode, instead it received an object with the type "'+typeof e+'".'),p()}function S(e){return g(e,{},{},!0)}function T(e){return g(e,{},{},!0)}function x(e){return new j(e,!1)}function _(e){return new j(e,!0)}function b(e){return new I(e,!1)}function Q(e){return new I(e,!0)}var N="a runtime error occured! Use Inferno in development environment to find the error.",k=Array.isArray,M=/[A-Z]/g,C={},w=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]),j=(function(e){function r(t,r){e.call(this),this.collector=[1/0],this.promises=[],this.pushQueue=this.pushQueue.bind(this),t&&this.renderVNodeToQueue(t,null,r,null)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype._read=function(){setTimeout(this.pushQueue,0)},r.prototype.addToQueue=function(e,t){if(o(t))"string"==typeof e&&this.collector.length-1==0?this.push(e):"string"==typeof e&&"string"==typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"==typeof this.promises[t][r]&&"string"==typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},r.prototype.pushQueue=function(){var e=this.collector[0];if("string"==typeof e)this.push(e),this.collector.shift();else if(e&&("object"==typeof e||s(e))&&s(e.then)){var t=this;e.then((function(e){(r=t.collector).splice.apply(r,[0,1].concat(t.promises[e])),t.promises[e]=null,setTimeout(t.pushQueue,0);var r})),this.collector[0]=null}else e===1/0&&this.emit("end")},r.prototype.renderVNodeToQueue=function(e,r,n,v){var y=this;if(i(e))this.addToQueue("\x3c!--!--\x3e",v);else{var g=e.flags,S=e.type,T=e.props||t.EMPTY_OBJ,x=e.children;if((28&g)>0)if(4&g){var _=new S(T,r);_._blockSetState=!1;var b;if(l(_.getChildContext)||(b=_.getChildContext()),o(b)||(r=h(r,b)),_.props===t.EMPTY_OBJ&&(_.props=T),_.context=r,_._pendingSetState=!0,_._unmounted=!1,s(_.componentWillMount)&&_.componentWillMount(),s(_.getInitialProps)){var Q=_.getInitialProps(_.props,_.context);if(Q){if(Promise.resolve(Q)===Q){var N=this.promises.push([])-1;return void this.addToQueue(Q.then((function(e){return _._pendingSetState=!1,"object"==typeof e&&(_.props=h(_.props,e)),y.renderVNodeToQueue(_.render(_.props,_.context),_.context,!0,N),setTimeout(y.pushQueue,0),N})),v)}_.props=h(_.props,Q)}}var M=_.render(T,e.context);_._pendingSetState=!1,this.renderVNodeToQueue(M,r,!0,v)}else{var C=S(T,r);this.renderVNodeToQueue(C,r,!0,v)}else if((3970&g)>0){var j,P="<"+S,I=w.has(S);if(o(e.className)||(P+=' class="'+f(e.className)+'"'),!c(T))for(var O in T){var V=T[O];"dangerouslySetInnerHTML"===O?j=V.__html:"style"===O?P+=' style="'+m(T.style)+'"':"children"===O||("defaultValue"===O?T.value||(P+=' value="'+f(V)+'"'):"defaultChecked"===O?T.checked||(P+=' checked="'+V+'"'):u(V)?P+=" "+O+'="'+f(V)+'"':a(V)?P+=" "+O+'="'+V+'"':d(V)&&(P+=" "+O))}if(I)this.addToQueue(P+">",v);else{if(P+=">",i(x)){if(j)return void this.addToQueue(P+j+"</"+S+">",v)}else{if(!k(x))return u(x)?void this.addToQueue(P+f(x)+"</"+S+">",v):a(x)?void this.addToQueue(P+x+"</"+S+">",v):(this.addToQueue(P,v),this.renderVNodeToQueue(x,r,!0,v),void this.addToQueue("</"+S+">",v));this.addToQueue(P,v),P="";for(var A=0,E=x.length;A<E;A++){var J=x[A];u(J)?y.addToQueue(f(J),v):a(J)?y.addToQueue(J+"",v):i(J)||y.renderVNodeToQueue(J,r,0===A,v)}}I||this.addToQueue(P+"</"+S+">",v)}}else(1&g)>0?this.addToQueue((n?"":"\x3c!----\x3e")+f(x),v):(p("object"==typeof e?"renderToString() received an object that's not a valid VNode, you should stringify it first. Object: \""+JSON.stringify(e)+'".':'renderToString() expects a valid VNode, instead it received an object with the type "'+typeof e+'".'),p())}},r})(r.Readable),P=Promise.resolve(),I=(function(e){function t(t,r){e.call(this),this.started=!1,this.initNode=t,this.staticMarkup=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){var e=this;this.started||(this.started=!0,P.then((function(){return e.renderNode(e.initNode,null,e.staticMarkup)})).then((function(){e.push(null)})).catch((function(t){e.emit("error",t)})))},t.prototype.renderNode=function(e,t,r){if(!i(e)){var n=e.flags;return(28&n)>0?this.renderComponent(e,r,t,4&n):(3970&n)>0?this.renderElement(e,r,t):this.renderText(e)}},t.prototype.renderComponent=function(e,t,r,n){var i=this,u=e.type,a=e.props;if(!n)return this.renderNode(u(a),r,t);var c=new u(a);c._blockSetState=!1;var d;return s(c.getChildContext)&&(d=c.getChildContext()),o(d)||(r=h(r,d)),c.context=r,c._pendingSetState=!0,Promise.resolve(c.componentWillMount&&c.componentWillMount()).then((function(){var e=c.render();return c._pendingSetState=!1,i.renderNode(e,r,t)}))},t.prototype.renderChildren=function(e,t){var r=this;if(u(e))return this.push(f(e));if(a(e))return this.push(f(e+""));if(e){var o=k(e);if(!o&&!i(e))return this.renderNode(e,t,!1);if(!o)throw new Error("invalid component");return e.reduce((function(e,o){return e.then((function(e){return n(o)?(!0===e&&r.push("\x3c!----\x3e"),u(o)?r.push(f(o)):r.push(o+""),!0):k(o)?(r.push("\x3c!----\x3e"),Promise.resolve(r.renderChildren(o)).then((function(){return r.push("\x3c!--!--\x3e"),!0}))):i(o)?void 0:((1&o.flags)>0&&e&&r.push("\x3c!----\x3e"),Promise.resolve(r.renderNode(o,t,!1)).then((function(){return!!(1&o.flags)})))}))}),Promise.resolve(!1))}},t.prototype.renderText=function(e){var t=this;return P.then((function(r){return t.push(e.children),r}))},t.prototype.renderElement=function(e,t,r){var n=this,i=e.type,s=e.props,u=y(s),a="",c=e.className;if(o(c)||u.push('class="'+f(c)+'"'),s){var d=s.style;d&&u.push('style="'+m(d)+'"'),s.dangerouslySetInnerHTML&&(a=s.dangerouslySetInnerHTML.__html)}if(t&&u.push("data-infernoroot"),this.push("<"+i+(u.length>0?" "+u.join(" "):"")+">"),!w.has(i))return a?(this.push(a),void this.push("</"+i+">")):Promise.resolve(this.renderChildren(e.children,r)).then((function(){n.push("</"+i+">")}))},t})(r.Readable),O={RenderQueueStream:j,RenderStream:I,renderToStaticMarkup:T,renderToString:S,streamAsStaticMarkup:Q,streamAsString:b,streamQueueAsStaticMarkup:_,streamQueueAsString:x};e.default=O,e.RenderQueueStream=j,e.RenderStream=I,e.renderToStaticMarkup=T,e.renderToString=S,e.streamAsStaticMarkup=Q,e.streamAsString=b,e.streamQueueAsStaticMarkup=_,e.streamQueueAsString=x,Object.defineProperty(e,"__esModule",{value:!0})}));
