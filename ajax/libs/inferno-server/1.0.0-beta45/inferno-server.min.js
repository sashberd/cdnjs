!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("./inferno"),require("stream")):"function"==typeof define&&define.amd?define(["inferno","stream"],r):(e.Inferno=e.Inferno||{},e.Inferno.Server=r(e.Inferno,e.stream))}(this,function(e,r){"use strict";function t(e){return String(e).replace(/[<>"'&]/g,b)}function n(e){return e.replace(S,"-$&").toLowerCase().replace(M,"-ms-")}function o(e){return!!C[e]}function i(e){return c(e)||l(e)}function u(e){return d(e)||f(e)}function s(e){return f(e)||!1===e||p(e)||d(e)}function a(e){return"function"==typeof e}function c(e){return"string"==typeof e}function l(e){return"number"==typeof e}function f(e){return null===e}function p(e){return!0===e}function d(e){return void 0===e}function h(e){throw e||(e=N),new Error("Inferno Error: "+e)}function m(e,r){for(var t in e)d(r[t])&&(r[t]=e[t])}function v(e,r,t){e.split(",").forEach(function(e){return r[e]=t})}function y(e){if(i(e))return e;var r="";for(var o in e){var s=e[o],a=l(s)&&!T[o]?"px":"";u(s)||(r+=n(o)+":"+t(s)+a+";")}return r}function x(r,n,c){var l=r.flags,d=r.type,v=r.props||e.EMPTY_OBJ,g=r.children;if(28&l){var k=4&l;if(u(d.defaultProps)||(m(d.defaultProps,v),r.props=v),k){var w=new d(v,n),b=w.getChildContext();u(b)||(n=Object.assign({},n,b)),w.props===e.EMPTY_OBJ&&(w.props=v),w.context=n,w._pendingSetState=!0,w._unmounted=!1,a(w.componentWillMount)&&w.componentWillMount();var S=w.render(v,r.context);return w._pendingSetState=!1,s(S)?"\x3c!--!--\x3e":x(S,n,!0)}var M=d(v,n);return s(M)?"\x3c!--!--\x3e":x(M,n,!0)}if(3970&l){var C,N="<"+d,_=o(d);if(!f(v))for(var I in v){var P=v[I];"dangerouslySetInnerHTML"===I?C=P.__html:"style"===I?N+=' style="'+y(v.style)+'"':"className"!==I||u(P)?i(P)?N+=" "+I+'="'+t(P)+'"':p(P)&&(N+=" "+I):N+=' class="'+t(P)+'"'}if(_)N+=">";else{if(N+=">",s(g))C&&(N+=C);else if(O(g))for(var T=0;T<g.length;T++){var j=g[T];s(j)||(N+=x(j,n,0===T))}else i(g)?N+=t(g):N+=x(g,n,!0);_||(N+="</"+d+">")}return N}if(1&l)return(c?"":"\x3c!----\x3e")+t(g);"production"!==process.env.NODE_ENV&&h("object"==typeof r?"renderToString() received an object that's not a valid VNode, you should stringify it first. Object: \""+JSON.stringify(r)+'".':'renderToString() expects a valid VNode, instead it received an object with the type "'+typeof r+'".'),h()}function g(e){if(i(e))return e;var r=[];for(var o in e){var s=e[o],a=l(s)&&!T[o]?"px":"";u(s)||r.push(n(o)+":"+t(s)+a+";")}return r.join()}function k(e){var r=[];return(e&&Object.keys(e)||[]).forEach(function(n,o){var u=e[n];switch(n){case"dangerouslySetInnerHTML":case"className":case"style":return;default:i(u)?r.push(t(n)+'="'+t(u)+'"'):p(u)&&r.push(t(n))}}),r}var w={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;","&":"&amp;"},b=function(e){return w[e]||e},S=/[A-Z]/g,M=/^ms-/,C={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},N="a runtime error occured! Use Inferno in development environment to find the error.",O=Array.isArray,_={},I={},P={},T={},j={},E={};v("xlink:href,xlink:arcrole,xlink:actuate,xlink:role,xlink:titlef,xlink:type",P,"http://www.w3.org/1999/xlink"),v("xml:base,xml:lang,xml:space",P,"http://www.w3.org/XML/1998/namespace"),v("volume,defaultValue,defaultChecked",_,!0),v("children,ref,key,selected,checked,value,multiple",j,!0),v("onClick,onMouseDown,onMouseUp,onMouseMove,onSubmit,onDblClick,onKeyDown,onKeyUp,onKeyPress",E,!0),v("muted,scoped,loop,open,checked,default,capture,disabled,readOnly,required,autoplay,controls,seamless,reversed,allowfullscreen,novalidate",I,!0),v("animationIterationCount,borderImageOutset,borderImageSlice,borderImageWidth,boxFlex,boxFlexGroup,boxOrdinalGroup,columnCount,flex,flexGrow,flexPositive,flexShrink,flexNegative,flexOrder,gridRow,gridColumn,fontWeight,lineClamp,lineHeight,opacity,order,orphans,tabSize,widows,zIndex,zoom,fillOpacity,floodOpacity,stopOpacity,strokeDasharray,strokeDashoffset,strokeMiterlimit,strokeOpacity,strokeWidth,",T,!0);var D=function(e){function r(r,t){e.call(this),this.started=!1,this.initNode=r,this.staticMarkup=t}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype._read=function(){var e=this;this.started||(this.started=!0,Promise.resolve().then(function(){return e.renderNode(e.initNode,null,e.staticMarkup)}).then(function(){e.push(null)}).catch(function(r){e.emit("error",r)}))},r.prototype.renderNode=function(e,r,t){if(!s(e)){var n=e.flags;return 28&n?this.renderComponent(e,t,r,4&n):3970&n?this.renderElement(e,t,r):this.renderText(e,t,r)}},r.prototype.renderComponent=function(e,r,t,n){var o=this,i=e.type,s=e.props;if(!n)return this.renderNode(i(s),t,r);var a=new i(s),c=a.getChildContext();return u(c)||(t=Object.assign({},t,c)),a.context=t,a._pendingSetState=!0,Promise.resolve(a.componentWillMount()).then(function(){var e=a.render();return a._pendingSetState=!1,o.renderNode(e,t,r)})},r.prototype.renderChildren=function(e,r){var n=this;if(i(e))return this.push(t(e));if(e){var o=O(e);if(!o&&!s(e))return this.renderNode(e,r,!1);if(!o)throw new Error("invalid component");return e.reduce(function(e,o){return e.then(function(e){var u=i(o);return u?(!0===e&&n.push("\x3c!----\x3e"),u&&n.push(t(o)),!0):O(o)?(n.push("\x3c!----\x3e"),Promise.resolve(n.renderChildren(o)).then(function(){return n.push("\x3c!--!--\x3e"),!0})):s(o)?void 0:(1&o.flags&&(e&&n.push("\x3c!----\x3e"),e=!0),n.renderNode(o,r,!1).then(function(e){return!!(1&o.flags)}))})},Promise.resolve(!1))}},r.prototype.renderText=function(e,r,t){var n=this;return Promise.resolve().then(function(r){return n.push(e.children),r})},r.prototype.renderElement=function(e,r,n){var i=this,s=e.type,a=e.props,c=k(a),l="";if(a){var f=a.className;u(f)||c.push('class="'+t(f)+'"');var p=a.style;p&&c.push('style="'+g(p)+'"'),a.dangerouslySetInnerHTML&&(l=a.dangerouslySetInnerHTML.__html)}if(r&&c.push("data-infernoroot"),this.push("<"+s+(c.length>0?" "+c.join(" "):"")+">"),!o(s))return l?(this.push(l),void this.push("</"+s+">")):Promise.resolve(this.renderChildren(e.children,n)).then(function(){i.push("</"+s+">")})},r}(r.Readable);return{renderToString:function(e){return x(e,{},!0)},renderToStaticMarkup:function(e){return x(e,{},!0)},streamAsString:function(e){return new D(e,!1)},streamAsStaticMarkup:function(e){return new D(e,!0)},RenderStream:D}});