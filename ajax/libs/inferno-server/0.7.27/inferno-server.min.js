!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("stream")):"function"==typeof define&&define.amd?define(["stream"],t):e.InfernoServer=t(e.stream)}(this,function(e){"use strict";function t(e,t){if(!i(e)){var r=n(e);(r&&e.length>0||!r)&&(t=t?Object.assign({},t,{children:e}):{children:e})}return t}function n(e){return e instanceof Array}function r(e){return e.prototype&&void 0!==e.prototype.render}function o(e){return s(e)||c(e)}function i(e){return d(e)||l(e)}function u(e){return l(e)||e===!1||e===!0||d(e)}function a(e){return"function"==typeof e}function s(e){return"string"==typeof e}function c(e){return"number"==typeof e}function l(e){return null===e}function p(e){return e===!0}function d(e){return void 0===e}function f(e,t,n){e.split(",").forEach(function(e){return t[e]=n})}function h(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\//g,"&#x2F;")}function m(e){return(e+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;")}function g(e){return e.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase()}function w(e){return!!K[e]}function v(e,n,o,u,a){if(n=t(o,n),r(e)){var s=new e(n,u),c=s.getChildContext();i(c)||(u=Object.assign({},u,c)),s.context=u,s._pendingSetState=!0,s.componentWillMount();var l=s.render();return s._pendingSetState=!1,b(l,u,a)}return b(e(n,u),u,a)}function y(e,t){if(e&&n(e)){for(var r=[],i=!1,a=0;a<e.length;a++){var s=e[a],c=o(s),l=u(s);c||l?(i===!0&&(u(s)?r.push("<!--!-->"):r.push("<!---->")),c&&r.push(h(s)),i=!0):n(s)?(r.push("<!---->"),r.push(y(s)),r.push("<!--!-->"),i=!0):(i=!1,r.push(b(s,t,!1)))}return r.join("")}return u(e)?"":o(e)?h(e):b(e,t,!1)||""}function x(e){if(o(e))return e;for(var t=[],n=Object.keys(e),r=0;r<n.length;r++){var u=n[r],a=e[u],s=c(a)&&!E[u]?"px":"";i(a)||t.push(g(u)+":"+m(a)+s+";")}return t.join()}function b(e,t,n){if(!u(e)){var r=e.bp,s=e.tag||r&&r.tag,c=[],l=e.className,d=e.style;if(a(s))return v(s,e.attrs,e.children,t,n);i(l)||c.push('class="'+m(l)+'"'),i(d)||c.push('style="'+x(d)+'"');var f=e.attrs,h=f&&Object.keys(f)||[],g="";return r&&r.hasAttrs===!0&&(h=r.attrKeys?r.attrKeys.concat(h):h),h.forEach(function(e,t){var n=h[t],r=f[n];"dangerouslySetInnerHTML"===n?g=r.__html:o(r)?c.push(m(n)+'="'+m(r)+'"'):p(r)&&c.push(m(n))}),n&&c.push("data-infernoroot"),w(s)?"<"+s+(c.length>0?" "+c.join(" "):"")+">":"<"+s+(c.length>0?" "+c.join(" "):"")+">"+(g||y(e.children,t))+"</"+s+">"}}function k(e){return b(e,null,!1)}function S(e){return b(e,null,!0)}function j(e){if(o(e))return e;for(var t=[],n=Object.keys(e),r=0;r<n.length;r++){var u=n[r],a=e[u],s=c(a)&&!E[u]?"px":"";i(a)||t.push(g(u)+":"+m(a)+s+";")}return t.join()}function O(e,t){var n=[],r=t&&Object.keys(t)||[];return e&&e.hasAttrs===!0&&(r=e.attrKeys?e.attrKeys.concat(r):r),r.forEach(function(e,i){var u=r[i],a=t[u];"dangerouslySetInnerHTML"!==u&&(o(a)?n.push(m(u)+'="'+m(a)+'"'):isTrue(a)&&n.push(m(u)))}),n}function C(e){return new F(e,(!1))}function N(e){return new F(e,(!0))}var _="undefined"!=typeof window&&window.document,M=_&&window.screen.width,I=_&&window.screen.height,A=0,T=0,L=0;_&&(window.onscroll=function(){A=window.scrollX,T=window.scrollY,L=performance.now()},window.resize=function(){A=window.scrollX,T=window.scrollY,M=window.screen.width,I=window.screen.height,L=performance.now()});var P=(_?document.body:null,"http://www.w3.org/1999/xlink"),z="http://www.w3.org/XML/1998/namespace",H={},W={},q={},E={};f("xlink:href,xlink:arcrole,xlink:actuate,xlink:role,xlink:titlef,xlink:type",q,P),f("xml:base,xml:lang,xml:space",q,z),f("volume,value",H,!0),f("muted,scoped,loop,open,checked,default,capture,disabled,selected,readonly,multiple,required,autoplay,controls,seamless,reversed,allowfullscreen,novalidate",W,!0),f("animationIterationCount,borderImageOutset,borderImageSlice,borderImageWidth,boxFlex,boxFlexGroup,boxOrdinalGroup,columnCount,flex,flexGrow,flexPositive,flexShrink,flexNegative,flexOrder,gridRow,gridColumn,fontWeight,lineClamp,lineHeight,opacity,order,orphans,tabSize,widows,zIndex,zoom,fillOpacity,floodOpacity,stopOpacity,strokeDasharray,strokeDashoffset,strokeMiterlimit,strokeOpacity,strokeWidth,",E,!0);var K={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},F=function(e){function s(t,n){e.call(this),this.initNode=t,this.staticMarkup=n,this.started=!1}return e&&(s.__proto__=e),s.prototype=Object.create(e&&e.prototype),s.prototype.constructor=s,s.prototype._read=function(){var e=this;this.started||(this.started=!0,Promise.resolve().then(function(){return e.renderNode(e.initNode,null,e.staticMarkup)}).then(function(){e.push(null)}).catch(function(t){e.emit("error",t)}))},s.prototype.renderNode=function(e,t,n){if(!u(e)){var r=e.bp,o=e.tag||r&&r.tag;return a(o)?this.renderComponent(o,e.attrs,e.children,t,n):this.renderNative(o,e,t,n)}},s.prototype.renderComponent=function(e,n,o,u,a){var s=this;if(n=t(o,n),!r(e))return this.renderNode(e(n,u),u,a);var c=new e(n,u),l=c.getChildContext();return i(l)||(u=Object.assign({},u,l)),c.context=u,c._pendingSetState=!0,Promise.resolve(c.componentWillMount()).then(function(){var e=c.render();return c._pendingSetState=!1,s.renderNode(e,u,a)})},s.prototype.renderChildren=function(e,t){var r=this;if(o(e))return this.push(h(e));if(e){var i=n(e);if(!i&&!u(e))return this.renderNode(e,t,!1);if(!i)throw new Error("invalid component");return e.reduce(function(e,i){return e.then(function(e){var a=o(i),s=u(i);return a||s?(e===!0&&(s?r.push("<!--!-->"):r.push("<!---->")),a&&r.push(h(i)),!0):n(i)?(r.push("<!---->"),Promise.resolve(r.renderChildren(i)).then(function(){return r.push("<!--!-->"),!0})):r.renderNode(i,t,!1).then(function(){return!1})})},Promise.resolve(!1))}},s.prototype.renderNative=function(e,t,n,r){var o=this,u=t.bp,a=t.attrs,s=t.className,c=t.style,l=O(u,a);i(s)||l.push('class="'+m(s)+'"'),i(c)||l.push('style="'+j(c)+'"');var p="";if(a&&"dangerouslySetInnerHTML"in a&&(p=a.dangerouslySetInnerHTML.__html),r&&l.push("data-infernoroot"),this.push("<"+e+(l.length>0?" "+l.join(" "):"")+">"),!w(e))return p?(this.push(p),void this.push("</"+e+">")):Promise.resolve(this.renderChildren(t.children,n)).then(function(){o.push("</"+e+">")})},s}(e.Readable),G={renderToString:k,renderToStaticMarkup:S,streamAsString:C,streamAsStaticMarkup:N,RenderStream:F};return G});